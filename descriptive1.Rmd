---
title: "Analyses Preliminaires version 1.1"
author: "Nicolas Migueres"
date: "29 janvier 2020"
output:
  word_document: default
  toc: yes
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE,message=TRUE,warning=TRUE}
knitr::opts_chunk$set(echo = FALSE)
```

# Analyse de la cohorte EUPHOCAS, projet T2/non T2

```{r nettoyage des données,include=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
library(readxl)
DATA<- read_excel(path="EAACI - Occupational Asthma - all databases 2006-2018 - 1518-Nicolas.xlsx",sheet=1,na=c("NA", "N A", "N / A", "N/A", "N/ A", "Not Available", "NOt available","","not available","not avaiable"),col_names = TRUE)

DATAREF<-DATA

library('stringr')
library("devtools")
library("Amelia")
library("questionr")
library("ggplot2")
library("wesanderson")
library("lmtest")
library("tidyr")
library("naniar")

#nettoyage de la base de donnee

colnames(DATA)[colnames(DATA)=="CODE_CENTER_COUNTRY"] <- "COUNTRY"
colnames(DATA)[colnames(DATA)=='CODE_CENTER_CITY']<-"CITY"
colnames(DATA)[colnames(DATA)=="DIAGNOSIS_SIC"]<-"DIAGNOSIS"
DATA$DIAGNOSIS<-as.factor(DATA$DIAGNOSIS)
colnames(DATA)[colnames(DATA)=="HEIGHT (in cm)"]<-"HEIGHT"
DATA$HEIGHT<-DATA$HEIGHT/100
DATA$BMI.CAT<-as.factor(DATA$BMI.CAT)
DATA$SEX<-as.factor(DATA$SEX)
DATA$SEX[DATA$SEX%in%c("F")]<-"female"
DATA$SEX[DATA$SEX%in%c("M")]<-"male"
DATA$RACE<-tolower(DATA$RACE)
DATA$RACE<-factor(DATA$RACE)
DATA$EDUCATION<-tolower(DATA$EDUCATION)
DATA$EDUCATION<-factor(DATA$EDUCATION)
DATA$JOB<-tolower(DATA$JOB)
DATA$JOB<-factor(DATA$JOB)
DATA$JOB[DATA$JOB%in%c("mechanical engineers")]<-"mechanical engineer"
DATA<-subset(DATA,select = -c(CODE_ISCO))
DATA$JOB_CLASS<-tolower(DATA$JOB_CLASS)
DATA$JOB_CLASS<-factor(DATA$JOB_CLASS)
DATA$AGENT_NAME<-tolower(DATA$AGENT_NAME)
DATA$AGENT_NAME<-as.character(DATA$AGENT_NAME)
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("isocyanates")]<-"isocyanate"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("flours")]<-"flour"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("acideanhydride","anhydre","anhydrides")]<-"acide anhydride"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("persulfates","persuphates","persulphate salts","persulphates","persulfate salts")]<-"persulfate"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("acrylates","acrilic polymer")]<-"acrylate"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("ammonium persulfates","ammonium persulphate")]<-"ammonium persulfate"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("cow epithel","cow hair","cow epithelia","bovine hair")]<-"cow epithelium"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("paint  and solvents","paints and solvants")]<-"paints and solvents"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("drugs")]<-"drug"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("mdi-icocyanate")]<-"mdi-isocyanate"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("methacrylates")]<-"methacrylate"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("mhhpa acid anhydride","mhhpanhydride")]<-"mhhpa anhydride"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("mouse","mouse epithelia")]<-"mouse epithelium"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("obechewood dust")]<-"obeche wood dust"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("horse","horse epithelial")]<-"horse epithelium"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("platinum salts")]<-"platinum salt"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("epoxy resine")]<-"epoxy resin"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("didecyl-diammonium","didecyl-dymethyl chloramonium","didecyl dimethyl ammonium chloride")]<-"didecyl-dimethyl ammonium chloride"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("isocyanate(hdi)","hdi-isoyanate","hdi-isocyanate","hdi hexamethylene-1,6 di isocyanate")]<-"isocyanate hdi"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("cyanoacrilate","cianoacrylates")]<-"cyanoacrylate"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("isocyanate- mdi")]<-"isocyanate mdi"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("quat ammonium")]<-"quaternary ammonium"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("stainless steel ")]<-"stainless steel"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("red cedar")]<-"red cedar wood"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("rat epitelium")]<-"rat epithelium"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("wood dusts","wood")]<-"wood dust"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("wheat")]<-"wheat flour"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("storage dust mite lepidoglyphus destructor")]<-"storage mite lepidoglyphus destructor"
DATA$AGENT_NAME[DATA$AGENT_NAME%in%c("aldehydes","aldehydes;benzenic solvants","aldéhydes","aldehydes; benzenic solvants")]<-"aldehyde"
DATA$AGENT_NAME<-factor(DATA$AGENT_NAME)
DATA$AGENT_CATEGORY[DATA$AGENT_CATEGORY%in%c("Enzymes","enzyme")]<-"enzymes"
colnames(DATA)[colnames(DATA)=="AGENT_MOLECULAR.WEIGHT"]<-"HMW/LMW"
colnames(DATA)[colnames(DATA)=="HMW/LMW"]<-"HMW.LMW"
DATA$HMW.LMW<-as.character(DATA$HMW.LMW)
DATA$HMW.LMW[DATA$HMW.LMW%in%c("unknown")]<-NA
DATA$HMW.LMW<-factor(DATA$HMW.LMW)
DATA$SMOKER<-tolower(DATA$SMOKER)
DATA$SMOKER<-factor(DATA$SMOKER)
colnames(DATA)[colnames(DATA)=="DELAY_ASTHMA..month."]<-"ASTHMA_DELAY"
colnames(DATA)[colnames(DATA)=="D_SX_W..month."]<-"ASTHMA_WORK_TIME"
DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.<-as.character(DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.)
DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.<-ifelse(as.character(DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.)%in%c("<12","<12 "),"11",as.character(DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.))
DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.<-ifelse(as.character(DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.)%in%c(" 12-18"," 12-18 "),"15",as.character(DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.))
DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.<-as.numeric(DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.)
DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.<-cut(DATA$AGE_ASTHMA_ONSET...12.years..12.18.years.or.age.,breaks = c(0,12,19,100),include.lowest = TRUE,labels = c("<12","12-18",">18"))
colnames(DATA)[colnames(DATA)=="AGE_ASTHMA_ONSET...12.years..12.18.years.or.age."]<-"AGE_ONSET_CAT"
DATA$LABA_W<-as.character(DATA$LABA_W)
DATA$LABA_W[DATA$LABA_W%in%c("no ")]<-"no"
DATA$LABA_W<-factor(DATA$LABA_W)
colnames(DATA)[colnames(DATA)=="ICS_W_DOSE...Mcg.day."]<-"ICS_W_DOSE"
colnames(DATA)[colnames(DATA)=="ICS_W_DOSE.GINA"]<-"ICS_W_GINA"
colnames(DATA)[colnames(DATA)=="LAMA_W..yes.no."]<-"LAMA_W"
colnames(DATA)[colnames(DATA)=="OCS_W..Mg.day."]<-"OCS_W_DOSE"
colnames(DATA)[colnames(DATA)=="TIME_LAST_EXP..month."]<-"TIME_LAST_EXP_M"

#remplacement ","par des "." pour transformer la variable en variable numérique
DATA$TIME_LAST_EXP_M<-str_replace_all(DATA$TIME_LAST_EXP_M,",",".")
DATA$TIME_LAST_EXP_M<-as.numeric(DATA$TIME_LAST_EXP_M)

colnames(DATA)[colnames(DATA)=="TIME_LAST_EXP...0.1..3days."]<-"TIME_LAST_EXP_D"
DATA$TIME_LAST_EXP_D<-as.character(DATA$TIME_LAST_EXP_D)
DATA$TIME_LAST_EXP_D[DATA$TIME_LAST_EXP_D%in%c("not avalaible")]<-"NA"
DATA$TIME_LAST_EXP_D<-factor(DATA$TIME_LAST_EXP_D)
colnames(DATA)[colnames(DATA)=="ICS_SIC_DOSE..Mcg.day."]<-"ICS_SIC_DOSE"
colnames(DATA)[colnames(DATA)=="ICS_SIC_DOSE.GINA"]<-"ICS_SIC_GINA"
DATA$THEO_SIC<-as.character(DATA$THEO_SIC)
DATA$THEO_SIC[DATA$THEO_SIC%in%c("no ")]<-"no"
DATA$THEO_SIC<-factor(DATA$THEO_SIC)
colnames(DATA)[colnames(DATA)=="OCS_SIC_DOSE..Mcg.day."]<-"OCS_SIC_DOSE"
DATA$AGENT_CATEGORY<-tolower(DATA$AGENT_CATEGORY)
DATA$AGENT_CATEGORY<-factor(DATA$AGENT_CATEGORY)
DATA$TIME_LAST_EXP_M<-as.character(DATA$TIME_LAST_EXP_M)
DATA$TIME_LAST_EXP_M[DATA$TIME_LAST_EXP_M%in%c("not avalaible")]<-"NA"
DATA$TIME_LAST_EXP_M<-factor(DATA$TIME_LAST_EXP_M)
DATA$NSBH_AGENT<-tolower(DATA$NSBH_AGENT)
DATA$NSBH_AGENT<-factor(DATA$NSBH_AGENT)
colnames(DATA)[colnames(DATA)=="DUR_EXPO_SIC..minutes."]<-"DUR_EXPO_SIC"
colnames(DATA)[colnames(DATA)=="CHANGE_NSBH_SIC_BASELINE.24"]<-"NSBH_SIC_RATIO"
colnames(DATA)[colnames(DATA)=="CHANGE_NSBH..2"]<-"NSBH_SIC_MAX_RATIO"
colnames(DATA)[colnames(DATA)=="BLOOD_EOSINO.300.mm³"]<-"BLOOD_EOSINO_300"
DATA$BLOOD_EOSINO_500<-ifelse(DATA$BLOOD_EOSINO>500,1,0)
colnames(DATA)[colnames(DATA)==c("NEUTRO_._PRE_SIC")]<-"NEUTRO_PRE_SIC"
colnames(DATA)[colnames(DATA)==c("NEUTRO_._PRE_SIC.61.")]<-"NEUTRO_PRE_SIC.61"
colnames(DATA)[colnames(DATA)==c("NEUTRO_._PRE_SIC.76.")]<-"NEUTRO_PRE_SIC.76"
colnames(DATA)[colnames(DATA)==c("NEUTRO_PRE_SIC..x106.ml.")]<-"NEUTRO_PRE_SIC_CELL"
colnames(DATA)[colnames(DATA)==c("NEUTRO_._POST_24_SIC")]<-"NEUTRO_POST_SIC"
colnames(DATA)[colnames(DATA)==c("NEUTRO_POST_24_SIC..x106.ml.")]<-"NEUTRO_POST_SIC_CELL"
colnames(DATA)[colnames(DATA)==c("EOSINO_._PRE_SIC")]<-"EOSINO_PRE_SIC"
colnames(DATA)[colnames(DATA)==c("EOSINO_._PRE_SIC.2.2.")]<-"EOSINO_PRE_SIC.2.2"
colnames(DATA)[colnames(DATA)==c("EOSINO_._PRE_SIC.3.")]<-"EOSINO_PRE_SIC.3"
colnames(DATA)[colnames(DATA)==c("EOSINO_PRE_SIC..x106.ml.")]<-"EOSINO_PRE_SIC_CELL"
colnames(DATA)[colnames(DATA)==c("EOSINO_._POST_24_SIC")]<-"EOSINO_POST_SIC"
colnames(DATA)[colnames(DATA)==c("EOSINO_POST_24_SIC..x106.ml.")]<-"EOSINO_POST_SIC_CELL"
colnames(DATA)[colnames(DATA)==c("CHANGE_EOSINO_..3.")]<-"CHANGE_EOSINO.3"
DATA$RESCUE_SABA_SIC<-as.character(DATA$RESCUE_SABA_SIC)
DATA$RESCUE_SABA_SIC[DATA$RESCUE_SABA_SIC==c("no ")]<-'no'
DATA$RESCUE_SABA_SIC<-factor(DATA$RESCUE_SABA_SIC)
DATA$BLOOD_EOSINO_500<-factor(DATA$BLOOD_EOSINO_500)
DATA$STATUS_SIC<-tolower(DATA$STATUS_SIC)
DATA$STATUS_SIC<-factor(DATA$STATUS_SIC)
colnames(DATA)<-tolower(colnames(DATA))

#Traitement de la valeur baseline_nsbh_value

DATA$baseline_nsbh_value<-str_replace_all(DATA$baseline_nsbh_value,",",".")

#introduction d'une nouvelle variable DATA$nsbh_grade selon une hyperréactivité bronchique par méthode, par unité  en severe moyen et absence (cf. tableaux annexe haut poids/bas poids moleculaire)
DATA$nsbh_grade=NULL
for (i in 1 :dim(DATA)[1]){
  if(!is.na(DATA$baseline_nsbh_value[i])){
  if( substr(DATA$baseline_nsbh_value[i],1,1)=="<"){
    DATA$nsbh_grade[i]<-"severe"
  } else  if (substr(DATA$baseline_nsbh_value[i],1,1)==">"){
    if(substr(DATA$baseline_nsbh_value[i],2,nchar(DATA$baseline_nsbh_value[i]))=="1.6"){
      if ( DATA$nsbh_method[i]=="Sovijarvi method"){
        DATA$nsbh_grade[i]<-"absent"
      }else{DATA$nsbh_grade[i]<-NA}
    }
    if(substr(DATA$baseline_nsbh_value[i],2,nchar(DATA$baseline_nsbh_value[i]))=="16"){
      DATA$nsbh_grade[i]<-"absent"
    }
    if(substr(DATA$baseline_nsbh_value[i],2,nchar(DATA$baseline_nsbh_value[i]))=="2.8"){
    DATA$nsbh_grade[i]<-NA
    }
    if(substr(DATA$baseline_nsbh_value[i],2,nchar(DATA$baseline_nsbh_value[i]))=="32"){
    DATA$nsbh_grade[i]<-"absent"
    }
    if(substr(DATA$baseline_nsbh_value[i],2,nchar(DATA$baseline_nsbh_value[i]))=="4.8"){
      if(DATA$nsbh_method[i]=="Tidal breath method"){
        DATA$nsbh_grade[i]<-"mild"
      }else{DATA$nsbh_grade[i]<-"absent"}
    }
  } else {
    if(DATA$nsbh_method[i]=="Tidal breath method"){
      if(as.numeric(DATA$baseline_nsbh_value[i])<1){
        DATA$nsbh_grade[i]<-"severe"
      }
      if(as.numeric(DATA$baseline_nsbh_value[i])>=1 & as.numeric(DATA$baseline_nsbh_value[i])<=16){
        DATA$nsbh_grade[i]<-"mild"
      }
      if(as.numeric(DATA$baseline_nsbh_value[i])>16){
        DATA$nsbh_grade[i]<-"absent"
      }
    }
    if(DATA$nsbh_method[i]=="Five breath dosimeter method"){
      if(DATA$nsbh_unit[i]=="PD20 FEV1 (mg)"){
        if(as.numeric(DATA$baseline_nsbh_value[i])<0.1){
          DATA$nsbh_grade[i]<-"severe"
        }
        if(as.numeric(DATA$baseline_nsbh_value[i])>=0.1 & as.numeric(DATA$baseline_nsbh_value[i])<=1.5){
          DATA$nsbh_grade[i]<-"mild"
        }
        if(as.numeric(DATA$baseline_nsbh_value[i])>1.5){
          DATA$nsbh_grade[i]<-"absent"
        }
      }else{
        if(as.numeric(DATA$baseline_nsbh_value[i])<1){
          DATA$nsbh_grade[i]<-"severe"
        }
        if(as.numeric(DATA$baseline_nsbh_value[i])>=1 & as.numeric(DATA$baseline_nsbh_value[i])<=16){
          DATA$nsbh_grade[i]<-"mild"
        }
        if(as.numeric(DATA$baseline_nsbh_value[i])>16){
          DATA$nsbh_grade[i]<-"absent"
        }
      }
    
    }
   if(DATA$nsbh_method[i]=="Sovijarvi method"){
     if(as.numeric(DATA$baseline_nsbh_value[i])<0.4){
       DATA$nsbh_grade[i]<-"severe"
     }
     if(as.numeric(DATA$baseline_nsbh_value[i])>=0.4 & as.numeric(DATA$baseline_nsbh_value[i])<=1.6){
       DATA$nsbh_grade[i]<-"mild"
     }
     if(as.numeric(DATA$baseline_nsbh_value[i])>1.6){
       DATA$nsbh_grade[i]<-"mild"
     }
   }
   if(DATA$nsbh_method[i]=="APS dosimeter method"){
     if(DATA$nsbh_unit[i]=="PD20 FEV1 (mg)"){
       if(as.numeric(DATA$baseline_nsbh_value[i])<0.1){
         DATA$nsbh_grade[i]<-"severe"
       }
       if(as.numeric(DATA$baseline_nsbh_value[i])>=0.1 & as.numeric(DATA$baseline_nsbh_value[i])<=1.4){
         DATA$nsbh_grade[i]<-"mild"
       }
       if(as.numeric(DATA$baseline_nsbh_value[i])>1.4){
         DATA$nsbh_grade[i]<-"absent"
       }
     }else{
       if(as.numeric(DATA$baseline_nsbh_value[i])<1){
         DATA$nsbh_grade[i]<-"severe"
       }
       if(as.numeric(DATA$baseline_nsbh_value[i])>=1 & as.numeric(DATA$baseline_nsbh_value[i])<=16){
         DATA$nsbh_grade[i]<-"mild"
       }
       if(as.numeric(DATA$baseline_nsbh_value[i])>16){
         DATA=nsbh_grade[i]<-"absent"
       }
     }
     }
  if(DATA$nsbh_method[i]=="Reservoir bag method") {
    if(as.numeric(DATA$baseline_nsbh_value[i])<0.1){
      DATA$nsbh_grade[i]<-"severe"
    }
    if(as.numeric(DATA$baseline_nsbh_value[i])>=0.1 & as.numeric(DATA$baseline_nsbh_value[i])<=0.3){
      DATA$nsbh_grade[i]<-"mild"
    }
    if(as.numeric(DATA$baseline_nsbh_value[i])>0.3){
      DATA$nsbh_grade[i]<-"absent"
    }
  }  
  if(DATA$nsbh_method[i]=="Mannitol dosimeter method"){
    if(as.numeric(DATA$baseline_nsbh_value[i])<=0.025){
      DATA$nsbh_grade[i]<-"severe"
    }
    if(as.numeric(DATA$baseline_nsbh_value[i])>0.025 & as.numeric(DATA$baseline_nsbh_value[i])<=0.635){
      DATA$nsbh_grade[i]<-"mild"
    }
    if(as.numeric(DATA$baseline_nsbh_value[i])>0.635){
      DATA$nsbh_grade[i]<-"absent"
    }
  }
  if(DATA$nsbh_method[i]=="PEF"|DATA$nsbh_method[i]=="spirometry"){
    DATA$nsbh_grade[i]<-NA
  }
         }
  
  }else{
    DATA$nsbh_grade[i]<-NA
  }
}


#suppression de l'individu 1199 car anomalie d'import
DATA<-DATA[-1199,]



```

## Description des données manquantes
```{r,(echo=FALSE)}
(sapply(DATA,function(x) sum(is.na(x))))*100/1198


missmap(DATA, main = "Missing values vs observed")

```


## Creation de la variable T2

```{r}
DATA$T2<-ifelse(test = (DATA$blood_eosino_300=="yes"&!is.na(DATA$blood_eosino_300))|(DATA$feno_pre_sic.50=="yes"&!is.na(DATA$feno_pre_sic.50))|(DATA$eosino_pre_sic.3=="yes"&!is.na(DATA$eosino_pre_sic.3)),1,0 )
DATA$T2<-ifelse(test=(is.na(DATA$blood_eosino_300))&(is.na(DATA$feno_pre_sic.50))&(is.na(DATA$eosino_pre_sic.3)),NA,DATA$T2)

barplotNM<-function(a,b,c,d,e,f){
  
  colnames(a) <- rep("",3)
  barplot(a,beside=TRUE,xlab="phenotype",ylab="pourcentage",main=b,col=wes_palette(n=c,name = "GrandBudapest1"),axes=FALSE,ylim=c(0,d))
  axis(side=1,at=e,labels=c("noT2","T2","ensemble"))
  legend("topright",legend = f,col=wes_palette(n=c,name = "GrandBudapest1"),lty = 1)
  axis(side=2)
}

```
## Analyse descriptive des echantillons selon T2 ou non T2 

### age

```{r}
by(DATA$age,DATA$T2,summary)
var.test(DATA$age[DATA$T2==1],DATA$age[DATA$T2==0])
t.test(DATA$age[DATA$T2==1],DATA$age[DATA$T2==0],na.rm=TRUE,var.equal = TRUE)
boxplot(DATA$age~DATA$T2,col=wes_palette(n=2,name = "GrandBudapest1"),ylab = "age",xlab = "statut T2",axes=FALSE, main=("age selon le phenotype"))
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("noT2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
```

### Sex

```{r}
DATA$sex<-factor(DATA$sex)
by(DATA$sex,DATA$T2,table)
tab<-table(DATA$sex,DATA$T2)
cprop(tab)
chisq.test(tab)
b<-cprop(tab)[1:2,1:3]
colnames(b)<-rep("",3)
barplot(b,beside=TRUE,ylab="pourcentage ",xlab = "phenotypage T2",main="repartition par sex",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE,xlim=c(0,10),ylim=c(0,110))
axis(side=1,at=c(2,5,8),labels = c("no T2","T2","ensemble"))
axis(side=2)
legend("topright",legend = c("femme","homme"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)

```

### IMC

```{r}
by(DATA$bmi,DATA$T2,summary)
boxplot(DATA$bmi~DATA$T2,xlab = "phenotype",ylab = 'bmi en kg/m2',main="Repartition BMI selon le phenotype",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
var.test(DATA$bmi[DATA$T2==1],DATA$bmi[DATA$T2==0])
var(DATA$bmi[DATA$T2==1],na.rm=TRUE)
var(DATA$bmi[DATA$T2==0],na.rm=TRUE)
t.test(DATA$bmi[DATA$T2==1],DATA$bmi[DATA$T2==0],na.rm=TRUE,var.equal = TRUE)
t.test(DATA$bmi[DATA$T2==1],DATA$bmi[DATA$T2==0],na.rm=TRUE,var.equal = FALSE)

```

### Tabagisme

```{r}
tabsm<-table(DATA$smoker,DATA$T2)
cprop(tabsm)
c<-cprop(tabsm)[1:3,1:3]
colnames(c)<-rep("",3)
barplot(c,beside=TRUE,xlab = "phenotype", ylab = "pourcentage",main = "statut tabagique",col=wes_palette(n=3,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at= c(3,7,11),labels=c("no T2","T2","ensemble"))
legend("topleft",legend = c("current","ex","never"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1)
axis(side=2)
chisq.test(tabsm)

```

### Niveau d'éducation

```{r}
DATA$education<-factor(DATA$education,c("primary","secondary","post-secondary"))
tabe<-table(DATA$education,DATA$T2)
d<-cprop(tabe)[1:3,1:3]
colnames(d)<-rep("",3)
barplot(d,beside=TRUE,xlab = "phenotype",ylab = "pourcentage",main="niveau d'education selon le phenotype",col=wes_palette(n=3,name = "GrandBudapest1"),axes = FALSE,xlim=c(0,15),ylim=c(0,100))
axis(side=1,at=c(3,7,11),labels=c("no T2","T2","ensemble"))
legend("topleft",legend=c("primary","secondary","post-secondary"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1)
axis(side=2)
cprop(tabe)
chisq.test(tabe)
```


### Atopie

```{r}
taba<-table(DATA$atopy,DATA$T2)
taba
cprop(taba)
e<-(cprop(taba)[1:2,1:3])
colnames(e)<-rep("",3)
barplot(e,beside=TRUE,xlab="phenotype",ylab="pourcentage",main="phenotype T2 et atopie",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE,ylim = c(0,70))
axis(side=1,at= c(2,5,8),labels=c("no T2","T2","ensemble"))
legend("topright",legend =c("pas atopique","atopique"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1 )
 
chisq.test(taba)

```

### Classification bas poids moléculaire/haut poids moléculaire


```{r}
tabw<-table(DATA$hmw.lmw,DATA$T2)
tabw
cprop(tabw)
f<-cprop(tabw)[1:2,1:3]
colnames(f)<-rep("",3)
barplot(f,beside=TRUE,xlab = "phenotype",ylab="pourcentage",main = "Statut HMW/LMW en fonction du phenotype T2/noT2",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE,ylim = c(0,70))
axis(side=1,at= c(2,5,8),labels=c("no T2","T2","ensemble"))
legend("topright",legend =c("HMW","LMW"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1 )
chisq.test(tabw)
```


### Presence d'IgE specifique ou prick test

```{r}
DATA$ige_mediated_oa<-as.character(DATA$ige_mediated_oa)
tabige<-table((DATA$ige_mediated_oa[DATA$ige_mediated_oa!="not performed"]),DATA$T2[DATA$ige_mediated_oa!="not performed"])
tabige
DATA$ige_mediated_oa<-factor(DATA$ige_mediated_oa)
cprop(tabige)
barplotNM(a=cprop(tabige)[1:2,1:3],b="IgE spe ou prick selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabige)
```


### Présence d'un asthme antérieur

```{r}
tabpre<-table(DATA$asthma_pre,DATA$T2)
tabpre
cprop(tabpre)
barplotNM(a=cprop(tabpre)[1:2,1:3],b=("Relation entre le phenotype et la preexistance d'un asthme"),c=2,d=100,e=(c(2,5,8)),f=(c("non","oui")))
chisq.test(tabpre)
```

### Nature de l'agent par catégorie

```{r}
tabcat<-table(DATA$agent_category,DATA$T2)
tabcat
lprop(tabcat)
```

### Toux

```{r}
tabcw<-table(DATA$cough_w,DATA$T2)
tabcw
cprop(tabcw)
barplotNM(a=cprop(tabcw)[1:2,1:3],b="phenotype et toux",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabcw)

```

### Présence de sifflement

```{r}
tabww<-table(DATA$wheezing_w,DATA$T2)
tabww
cprop(tabww)
barplotNM(a=cprop(tabww)[1:2,1:3],b="sifflement et phenotype",c=2,d=100,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabww)
```

### Dyspnée

```{r}
tabdw<-table(DATA$dyspnea_w,DATA$T2)
tabdw
cprop(tabdw)
barplotNM(a=cprop(tabdw)[1:2,1:3],b="dyspnee et phenotype",c=2,d=120,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabdw)
```

###Serrement

```{r}
tabtw<-table(DATA$tightness_w,DATA$T2)
tabtw
cprop(tabtw)
barplotNM(a=cprop(tabtw)[1:2,1:3],b="serrement et phenotype",c=2,d=100,e=c(2,5,8),f=c("non","yes"))
chisq.test(tabtw)
```

###Crachat

```{r}
tabspw<-table(DATA$sputum,DATA$T2)
tabspw
cprop(tabspw)
barplotNM(a=cprop(tabspw)[1:2,1:3],b="crachat au travail selon le phenotype",c=2,d=100,e=c(2,5,8),f=c("no","yes"))
chisq.test(tabspw)
```

###Rhinite

```{r}
tabrw<-table(DATA$rhinitis_w,DATA$T2)
tabrw
cprop(tabrw)
barplotNM(a=cprop(tabrw)[1:2,1:3],b="rhinite au travail selon le phenotype",c=2,d=100,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabrw)
```

###Debut rhinite

```{r}
DATA$onset_of_rhinitis_w<-as.character(DATA$onset_of_rhinitis_w)
taborw<-taborw<-table((DATA$onset_of_rhinitis_w[DATA$onset_of_rhinitis_w!="not applicable"]),DATA$T2[DATA$onset_of_rhinitis_w!="not applicable"])
taborw
DATA$onset_of_rhinitis_w<-factor(DATA$onset_of_rhinitis_w)
cprop(taborw)
barplotNM(a = cprop(taborw)[1:3,1:3],b= "apparition rhinite au travail selon le phenotype",c=3,d=80,e=c(4,7,10),f=c("after","at the same time","before") )
chisq.test(taborw)
```


###conjonctivite

```{r}
tab2<-table(DATA$conjonct_w,DATA$T2)
cprop(tab2)
barplotNM(a =cprop(tab2)[1:2,1:3],b="conjonctivite au travail selon le phenotype",c=2,d=80,e= c(2,5,8),f=c("non","oui"))
chisq.test(tab2)

```

###eczema

```{r}
tabec<-table(DATA$eczema_w,DATA$T2)
tabec
cprop(tabec)
barplotNM(a =cprop(tabec)[1:2,1:3],b="eczema au travail selon le phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui") )
chisq.test(tabec)
```

###urticaire

```{r}
taburt<-table(DATA$urticaria_w,DATA$T2)
taburt
cprop(taburt)
barplotNM(a=cprop(taburt)[1:2,1:3],b="urticaire au travail selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(taburt)
```

###Dysphonie

```{r}
tabdys<-table(DATA$dysphonia_w,DATA$T2)
tabdys
cprop(tabdys)
barplotNM(a=cprop(tabdys)[1:2,1:3],b="dysphonie au travail selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabdys)
```

###Sinusite

```{r}
tabsin<-table(DATA$sinusitis,DATA$T2)
tabsin
cprop(tabsin)
barplotNM(a=cprop(tabsin)[1:2,1:3],b="sinusite selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabsin)

```


###Délai d'apparition de l'asthme

```{r}
by(DATA$asthma_delay,DATA$T2,summary)
boxplot(DATA$asthma_delay~DATA$T2,ylab = "delai d'apparition de l'asthme en mois",xlab = "phenotype",main="delai d'apparition de l'asthme selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
#verification de l normalite de distribution des populations
hist(DATA$asthma_delay[DATA$T2==0])
qqnorm(DATA$asthma_delay[DATA$T2==0])
shapiro.test(DATA$asthma_delay[DATA$T2==0])
#recherche de normalite apres transformation logarythmique
hist(log(DATA$asthma_delay[DATA$T2==0]))
#recherche d'egalite des variances
var.test(DATA$asthma_delay[DATA$T2==0],DATA$asthma_delay[DATA$T2==1])
wilcox.test(DATA$asthma_delay[DATA$T2==0],DATA$asthma_delay[DATA$T2==1],var.equal = TRUE,na.rm=TRUE)
```

###Age d'apparition de l'asthme

```{r}
summary(DATA$age_onset_cat)
tabonset<-table(DATA$age_onset_cat,DATA$T2)
tabonset
cprop(tabonset)
barplotNM(a=cprop(tabonset)[1:3,1:3],b="age d'apparition de l'asthme selon le phenotype",c=3,d=130,e=c(4,7,10),f=c("<12 and","12-18 ans",">18 ans"))

chisq.test(tabonset)

```

###Durée des symptomes au travail en mois

```{r}
summary(DATA$asthma_work_time)
hist(DATA$asthma_work_time[DATA$T2==1],breaks = 300)
by(DATA$asthma_work_time,DATA$T2,summary)
boxplot(DATA$asthma_work_time~DATA$T2,xlab = "phenotype",ylab = "temps de travail avec symptomes en mois",main="temps de travail avec symptomes selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
var.test(DATA$asthma_work_time[DATA$T2==0],DATA$asthma_work_time[DATA$T2==1])
t.test(DATA$asthma_work_time,DATA$T2,var.equal = FALSE,na.rm=TRUE)
t.test(DATA$asthma_work_time,DATA$T2,var.equal = TRUE,na.rm=TRUE)
wilcox.test(DATA$asthma_work_time,DATA$T2,na.rm=TRUE)

```

###délai depuis la dernière exposition

```{r}
summary(DATA$time_last_exp_m)
DATA$time_last_exp_m<-as.numeric(DATA$time_last_exp_m)
by(DATA$time_last_exp_m,DATA$T2,summary)
hist(DATA$time_last_exp_m[DATA$T2==0],breaks=100)
boxplot(DATA$time_last_exp_m~DATA$T2,xlab="phenotype",ylab="nombre de mois depuis la dernière exposition",main="rapport entre le phenotype et a derniere exposition",col=wes_palette("GrandBudapest1",2),axes=FALSE,ylim=c(0,120))
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
var.test(DATA$time_last_exp_m[DATA$T2==1],DATA$time_last_exp_m[DATA$T2==0])
t.test(DATA$time_last_exp_m[DATA$T2==1],DATA$time_last_exp_m[DATA$T2==0],var.equal = TRUE,na.rm=TRUE)
wilcox.test(DATA$time_last_exp_m[DATA$T2==1],DATA$time_last_exp_m[DATA$T2==0],na.rm=TRUE)
```

###utilisation des SABA

```{r}
summary(DATA$saba_w_frequency)
DATA$saba_w_frequency<-factor(DATA$saba_w_frequency,c("?3 times a day","1 or 2 times a day","2 or more times a week","once or less per week","never"))
tabsa<-table(DATA$saba_w_frequency,DATA$T2)
tabsa
cprop(tabsa)
g<-cprop(tabsa)[1:5,1:3]
colnames(g)<-rep("",3)
barplot(g,beside=TRUE,xlab="phenotype",ylab = " utilisation de SABA", main="utilisation de SABA selon le phenotype",axes=FALSE,ylim =c(0,80),col=wes_palette(n=5,name = "BottleRocket1"))
axis(side=1,at=c(3,9,15),labels =c("noT2","T2","ensemble") )
axis(side=2)
legend("topright",legend = c(">3 fois par jours","1 à 2 fois par jours","2 fois ou plus par semaines","une fois par semaine ou moins","jamais"),col=wes_palette(n=5,name = "BottleRocket1"),lty = 1)

chisq.test(tabsa)

```

###utilisation des ICS

```{r}
summary(DATA$ics_w_gina)
DATA$ics_w_gina<-factor(DATA$ics_w_gina,c("high","medium","low","no ICS"))
tabics<-table(DATA$ics_w_gina,DATA$T2)
tabics
cprop(tabics)
barplotNM(a=cprop(tabics)[1:4,1:3],b="utilisation des ICS selon le phenotype",c=4,d=80,e=c(3,8,13),f=c("haut","moyen","bas","pas de CSI"))
chisq.test(tabics)
```

###utilisation des laba

```{r}
summary(DATA$laba_w)
tabala<-table(DATA$laba_w,DATA$T2)
tabala
cprop(tabala)
barplotNM(a=cprop(tabala)[1:2,1:3],b="utilisation de laba selon le phenotype",c=2,d=80,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabala)
```

###utilisation des leukotriène

```{r}
summary(DATA$ltra_w)
tabltra<-table(DATA$ltra_w,DATA$T2)
tabltra
cprop(tabltra)
barplotNM(a=cprop(tabltra)[1:2,1:3],b="utilisation de leucotriene selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabltra)
```

###corticoide oraux

```{r}
summary(DATA$ocs_w)
#transformation en variable dichotomique:
DATA$ocs_w_nb<-ifelse(DATA$ocs_w_dose==0,"no","yes")
table(DATA$ocs_w_nb)
tabocs<-table(DATA$ocs_w_nb,DATA$T2)
cprop(tabocs)
tabocs
barplotNM(a=cprop(tabocs)[1:2,1:3],b="utilisation de CSO selon le phenotype",c=2,d=125,e=c(2,5,8),f=c("non","oui"))
"utilisation du test exact de fischer car effectif attendu de petite taille"
fisher.test(tabocs)
```

###anti-histaminique

```{r}
summary(DATA$anti_h1_w)
tabhist<-table(DATA$anti_h1_w,DATA$T2)
tabhist
cprop(tabhist)
barplotNM(a=cprop(tabhist)[1:2,1:3],b="utilisation d'anti-histaminique selon le phenotype",c=2,d=100,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabhist)
```

###corticoide nasaux

```{r}
summary(DATA$ncs_w)
tabncs<-table(DATA$ncs_w,DATA$T2)
tabncs
cprop(tabncs)
barplotNM(a=cprop(tabncs)[1:2,1:3],b="utilisation d'anti-histaminique nasaux selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabncs)
```

###sévérite GINA

```{r}
summary(DATA$severity_asthma_gina_w)
DATA$severity_asthma_gina_w<-factor(DATA$severity_asthma_gina_w,c("severe","moderate","mild","no treatment"))
tabgin<-table(DATA$severity_asthma_gina_w,DATA$T2)
tabgin
cprop(tabgin)
barplotNM(a=cprop(tabgin)[1:4,1:3],b="stade de severite selon le GINA",c=4,d=60,e=c(3,8,13),f=c("severe","modere","leger","non traite"))
chisq.test(tabgin)
```

###exacerbation

```{r}
summary(DATA$exacerbation_w)
#transformation en variable dichotomique (plus d'une exacerbation ou pas)
DATA$exacerbation_w_nb<-ifelse(DATA$exacerbation_w==0,"no","yes")
DATA$exacerbation_w_nb<-factor(DATA$exacerbation_w_nb)
summary(DATA$exacerbation_w_nb)
tabex<-table(DATA$exacerbation_w_nb,DATA$T2)
tabex
cprop(tabex)
barplotNM(a=cprop(tabex)[1:2,1:3],b="exacerbation l'année precedente selon le phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabex)
```

###non control selon le GINA (création nouvelle variable: non controlé si au moins une exacerbation sévère ou plus de 2 utilisation de SABA par semaine)

```{r}
DATA$uncontrolled_gina_w<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$asthma_control_w[i]) | is.na(DATA$exacerbation_w_nb[i])) {
    DATA$uncontrolled_gina_w[i] <- NA
  }
  
  if( (!is.na(DATA$asthma_control_w[i]) & !is.na(DATA$exacerbation_w_nb[i])) & DATA$asthma_control_w[i]=="asthma controlled" & DATA$exacerbation_w_nb[i]=="no"){
    DATA$uncontrolled_gina_w[i] <- "no"
  }
  if( (!is.na(DATA$asthma_control_w[i]) & !is.na(DATA$exacerbation_w_nb[i])) & (DATA$asthma_control_w[i]=="asthma uncontrolled" | DATA$exacerbation_w_nb[i]=="yes")){
    DATA$uncontrolled_gina_w[i] <- "yes"
  }
}

tabcont<-table(DATA$uncontrolled_gina_w,DATA$T2)
tabcont
cprop(tabcont)
barplotNM(a=cprop(tabcont)[1:2,1:3],b="asthme non controlé",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabcont)

```


###VEMS

```{r}
summary(DATA$baseline_fev1)
by(DATA$baseline_fev1,DATA$T2,summary)
boxplot(DATA$baseline_fev1~DATA$T2,xlab = "phenotype",ylab = "VEMS de base",main="VEMS selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE,ylim=c(0,180))
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$baseline_fev1[DATA$T2==1],breaks=200)
hist(DATA$baseline_fev1[DATA$T2==0],breaks=200)
var.test(DATA$baseline_fev1[DATA$T2==0],DATA$baseline_fev1[DATA$T2==1])
t.test(DATA$baseline_fev1[DATA$T2==0],DATA$baseline_fev1[DATA$T2==1],var.equal = TRUE,na.rm=TRUE)
```

###VEMS<80%

```{r}
summary(DATA$baseline_fev1.80.)
tabfev<-table(DATA$baseline_fev1.80.,DATA$T2)
tabfev
cprop(tabfev)
barplotNM(a =cprop(tabfev)[1:2,1:3],b=" VEMS<80% selon le phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabfev)
```

###Tiffeneau

```{r}
summary(DATA$fev1.fvc)
by(DATA$fev1.fvc,DATA$T2,summary)
boxplot(DATA$fev1.fvc~DATA$T2,xlab = "phenotype",ylab = "coefficient de Tiffeneau",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$fev1.fvc[DATA$T2==1],breaks = 300)
hist(DATA$fev1.fvc[DATA$T2==0],breaks = 300)
qqnorm(DATA$fev1.fvc[DATA$T2==1])
var.test(DATA$fev1.fvc[DATA$T2==1],DATA$fev1.fvc[DATA$T2==0])
t.test(DATA$fev1.fvc[DATA$T2==1],DATA$fev1.fvc[DATA$T2==0],na.rm=TRUE)
```

###Trouble Ventilatoire obstructif

```{r}
summary(DATA$airway_obstruction)
tabobs<-table(DATA$airway_obstruction,DATA$T2)
tabobs
cprop(tabobs)
barplotNM(a=cprop(tabobs)[1:2,1:3],b="obstruction bronchique selon phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabobs)
```

###niveau d'hyper-réactivité bronchique selon le phenotype
```{r}
table(DATA$nsbh_grade)
tabgrad<-table(DATA$nsbh_grade,DATA$T2)
tabgrad
cprop(tabgrad)
barplotNM(a=cprop(tabgrad)[1:3,1:3],b="niveau d'HRB selon le phénotype",c=3,d=80,e=c(2,6,10),f=c("absent","modere","severe"))
chisq.test(tabgrad)
```



###Changement Hyper-reactivite bronchique 

```{r}
summary(DATA$nsbh_sic_ratio)
by(DATA$nsbh_sic_ratio,DATA$T2,summary)
boxplot(DATA$nsbh_sic_ratio~DATA$T2,xlab = "phenotype",ylab = "ratio de test d'hyperreactivite bronchique",main="ratio de test d'hyperreactivite bronchique selon le phenotype",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$nsbh_sic_ratio[DATA$T2==1],breaks = 400)
hist(DATA$nsbh_sic_ratio[DATA$T2==0],breaks = 400)
var.test(DATA$nsbh_sic_ratio[DATA$T2==1],DATA$nsbh_sic_ratio[DATA$T2==0])
wilcox.test(DATA$nsbh_sic_ratio[DATA$T2==1],DATA$nsbh_sic_ratio[DATA$T2==0])
```

###Ratio d'HRB>2

```{r}
summary(DATA$nsbh_sic_max_ratio)
tabrat<-table(DATA$nsbh_sic_max_ratio,DATA$T2)
tabrat
cprop(tabrat)
barplotNM(a=cprop(tabrat)[1:2,1:3],b="taux de ration d'hyper reactivite bronchique superieur a 2 et phenotype",c=2,d=75,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabrat)
```


###Reponse immediate

```{r}
summary(DATA$early_reaction)
tabear<-table(DATA$early_reaction,DATA$T2)
tabear
cprop(tabear)
barplotNM(a=cprop(tabear)[1:2,1:3],b="nombre de reaction precoce selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabear)
```

###reponse tardif

```{r}
summary(DATA$late_reaction)
tablat<-table(DATA$late_reaction,DATA$T2)
tablat
cprop(tablat)
barplotNM(a=cprop(tablat)[1:2,1:3],b="nombre de reaction tardive selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(tablat)
```

###reponse precoce uniquement

```{r}
#creation de la variable d'interet avec une boucle for
DATA$only_early<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$early_reaction[i]) & is.na(DATA$late_reaction[i])) {
    DATA$only_early[i] <- NA
  }
  if(is.na(DATA$early_reaction[i]) | is.na(DATA$late_reaction[i])) {
    DATA$only_early[i] <- NA
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & DATA$early_reaction[i]=="yes" & DATA$late_reaction[i]=="no"){
    DATA$only_early[i] <- "yes"
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & (DATA$early_reaction[i]!="yes" | DATA$late_reaction[i]!="no")){
    DATA$only_early[i] <- "no"
  }
}

DATA$only_early<-factor(DATA$only_early)
summary(DATA$only_early)
tabonear<-table(DATA$only_early,DATA$T2)
tabonear
cprop(tabonear)
barplotNM(a=cprop(tabonear)[1:2,1:3],b="nombre de reaction precoce uniquement selon le phenotype",c="2",d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabonear)

```


###reponse tardive uniquement

```{r}
#creation de la variablepar boucle for

DATA$only_late<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$early_reaction[i]) | is.na(DATA$late_reaction[i])) {
    DATA$only_late[i] <- NA
  }
  
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & DATA$early_reaction[i]=="no" & DATA$late_reaction[i]=="yes"){
    DATA$only_late[i] <- "yes"
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & (DATA$early_reaction[i]!="no" | DATA$late_reaction[i]!="yes")){
    DATA$only_late[i] <- "no"
  }
}
DATA$only_late<-factor(DATA$only_late)
summary(DATA$only_late)
tabonlate<-table(DATA$only_late,DATA$T2)
tabonlate
cprop(tabonlate)
barplotNM(a=cprop(tabonlate)[1:2,1:3],b="nombre de reaction tardive uniquement selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabonlate)
```




###reponse precoce et tardive

```{r}
#creation de la variable par boucle for
DATA$early_late<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$early_reaction[i]) | is.na(DATA$late_reaction[i])) {
    DATA$early_late[i] <- NA
  }
  
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & DATA$early_reaction[i]=="yes" & DATA$late_reaction[i]=="yes"){
    DATA$early_late[i] <- "yes"
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & (DATA$early_reaction[i]=="no" | DATA$late_reaction[i]=="no")){
    DATA$early_late[i] <- "no"
  }
}

DATA$early_late<-factor(DATA$early_late)
summary(DATA$early_late)

taboth<-table(DATA$early_late,DATA$T2)
taboth
cprop(taboth)
barplotNM(a=cprop(taboth)[1:2,1:3],b="proportion de reaction mixte selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(taboth)
```



###expecto pre SIC neutrophile

```{r}
summary(DATA$neutro_pre_sic)
by(DATA$neutro_pre_sic,DATA$T2,summary)
boxplot(DATA$neutro_pre_sic~DATA$T2,xlab = "phenotype",ylab = "% neutro au expectoration",main="%neutro dans les expectoration selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE,ylim=c(0,150))
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$neutro_pre_sic[DATA$T2==1],breaks = 100)
hist(DATA$neutro_pre_sic[DATA$T2==0],breaks = 100)
qqnorm(DATA$neutro_pre_sic[DATA$T2==1])
qqnorm(DATA$neutro_pre_sic[DATA$T2==0])
shapiro.test(DATA$neutro_pre_sic[DATA$T2==1])
shapiro.test(DATA$neutro_pre_sic[DATA$T2==0])
var.test(DATA$neutro_pre_sic[DATA$T2==0],DATA$neutro_pre_sic[DATA$T2==1])
t.test(DATA$neutro_pre_sic[DATA$T2==0],DATA$neutro_pre_sic[DATA$T2==1],var.equal = TRUE,na.rm=TRUE)
```

###expecto pre SIC >/=76% neutro

```{r}
summary(DATA$neutro_pre_sic.76)
tabneu<-table(DATA$neutro_pre_sic.76,DATA$T2)
tabneu
cprop(tabneu)
barplotNM(a=cprop(tabneu)[1:2,1:3],b=" proportion de neutrophile sup ou egale a 76% selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabneu)
```


###expecto pre SIC >/= 61% neutro

```{r}
tabneu61<-table(DATA$neutro_pre_sic.61,DATA$T2)
tabneu61
cprop(tabneu61)
barplotNM(a =cprop(tabneu61)[1:2,1:3],b=" proportion de neutrophile sup ou egale a 61% selon le phenotype",c="2",d=90,e=c(2,5,8),f=c("non","oui") )

chisq.test(tabneu)
```


###changement de neutrophile au expecto pendant le SIC

```{r}
summary(DATA$change_neutro)
by(DATA$change_neutro,DATA$T2,summary)
boxplot(DATA$change_neutro~DATA$T2,xlab = "phenotype",ylab = "changement de neutrophile dans les expectorations",main="changement de neutrophile dans les expectorations selon le phenotype",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$change_neutro[DATA$T2==1],breaks = 75)
hist(DATA$change_neutro[DATA$T2==0],breaks = 75)
var.test(DATA$change_neutro[DATA$T2==0],DATA$change_neutro[DATA$T2==1])
t.test(DATA$change_neutro[DATA$T2==0],DATA$change_neutro[DATA$T2==1],var.equal = TRUE,na.rm=TRUE)
```

###changement de FeNO pendant le SIC

```{r}
summary(DATA$change_feno.17.5ppb)
tabfeno<-table(DATA$change_feno.17.5ppb,DATA$T2)
tabfeno
cprop(tabfeno)
barplotNM(a=cprop(tabfeno)[1:2,1:3],b="changement de FeNO sup ou egal à 17.5% selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabfeno)
```


###changement des eosino expecto post SIC

```{r}
summary(DATA$change_eosino.3)
tabcheo<-table(DATA$change_eosino.3,DATA$T2)
tabcheo
cprop(tabcheo)
barplotNM(a=cprop(tabcheo)[1:2,1:3],b="changement d'Eo dans les expecto sup ou egal a 3% selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))

```


###profil d'inflammation pre SIC eosinophilique pur (cut off neutro à 61)

```{r}
#creation de la variable par boucle for
DATA$pre_eosino<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_pre_sic.3[i]) | is.na(DATA$neutro_pre_sic.61[i])) {
    DATA$pre_eosino[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & DATA$eosino_pre_sic.3[i]=="yes" & DATA$neutro_pre_sic.61[i]=="no"){
    DATA$pre_eosino[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & (DATA$eosino_pre_sic.3[i]!="yes" | DATA$neutro_pre_sic.61[i]!="no")){
    DATA$pre_eosino[i] <- "no"
  }
}
DATA$pre_eosino<-factor(DATA$pre_eosino)
#analyse descriptive
tabpreo<-table(DATA$pre_eosino,DATA$T2)
tabpreo
cprop(tabpreo)
barplotNM(a =cprop(tabpreo)[1:2,1:3],b="profil sputum pre sic eosino strict par phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui","ensemble") )
chisq.test(tabpreo)

```

###profil neutro pre sic (cut off 61)

```{r}
#création de la variable
DATA$pre_neutro<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$neutro_pre_sic.61[i])|is.na(DATA$eosino_pre_sic.3[i])){
    DATA$pre_neutro[i]<-NA
  }
  if((!is.na(DATA$neutro_pre_sic.61[i]) & !is.na(DATA$eosino_pre_sic.3[i])) & (DATA$neutro_pre_sic.61[i]=="yes" & DATA$eosino_pre_sic.3[i]=="no")){
    DATA$pre_neutro[i]<-"yes"
  }
  if((!is.na(DATA$neutro_pre_sic.61[i]) & !is.na(DATA$eosino_pre_sic.3[i])) & (DATA$neutro_pre_sic.61[i]!="yes" & DATA$eosino_pre_sic.3[i]!="no")){
    DATA$pre_neutro[i]<-"no"
}
}
#descriptif
tabpreneu<-table(DATA$pre_neutro,DATA$T2)
tabpreneu
cprop(tabpreneu)
by(DATA$pre_neutro,DATA$T2,summary)
barplotNM(a=cprop(tabpreneu)[1:2,1:3],b="profil sputum neutro strict selon le phenotype",c=2,d=130,e=c(2,5,8),f=c("non","yes"))
chisq.test(tabpreneu)
```

###profil mixed granulocytic

```{r}
#creation de la variable par boucle for
DATA$pre_mixte<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_pre_sic.3[i]) | is.na(DATA$neutro_pre_sic.61[i])) {
    DATA$pre_mixed[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & DATA$eosino_pre_sic.3[i]=="yes" & DATA$neutro_pre_sic.61[i]=="yes"){
    DATA$pre_mixed[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & (DATA$eosino_pre_sic.3[i]!="yes" | DATA$neutro_pre_sic.61[i]!="yes")){
    DATA$pre_mixed[i] <- "no"
  }
}
#descriptif
tabpremix<-table(DATA$pre_mixed,DATA$T2)
by(DATA$pre_mixed,DATA$T2,table)
DATA$pre_mixed<-factor(DATA$pre_mixed)
cprop(tabpremix)
barplotNM(a=cprop(tabpremix)[1:2,1:3],b="profil sputum mixed granulocytique selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("no","yes"))
chisq.test(tabpremix)
```

###profil pre paucigranulocytic

```{r}
DATA$pre_pauci<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_pre_sic.3[i]) | is.na(DATA$neutro_pre_sic.61[i])) {
    DATA$pre_pauci[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & DATA$eosino_pre_sic.3[i]=="no" & DATA$neutro_pre_sic.61[i]=="no"){
    DATA$pre_pauci[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & (DATA$eosino_pre_sic.3[i]!="no" | DATA$neutro_pre_sic.61[i]!="no")){
    DATA$pre_pauci[i] <- "no"
  }
}
tabprepauci<-table(DATA$pre_pauci,DATA$T2)
by(DATA$pre_pauci,DATA$T2,summary)
cprop(tabprepauci)
barplotNM(a=cprop(tabprepauci)[1:2,1:3],b="profil sputum paucigranulocytique selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("no","yes"))
chisq.test(tabprepauci)

```


##synthèse des données sputum selon phénotype

###Avant l'exposition

```{r}
#création camenbert T2
valeurs<-c(13.7,19.6,51.5,15.2)
pie(valeurs,col=wes_palette(n=4,name = "GrandBudapest1"),labels=c("paucigranulomateux","mixed granulomateux","eosinophilique strict","neutrophilique"),main="distribution endotypique des asthmes T2")

#création camenbert noT2

valeursno2<-c(65.4,34.6)
pie(valeursno2,col=wes_palette(n=2,name = "GrandBudapest1"),labels=c("paucigranulomateux","neutrophilique"),main="distribution endotypique des asthmes non T2")

```



## Analyse descriptive selon hmw.lmw


### age

```{r}
by(DATA$age,DATA$hmw.lmw,summary)
var.test(DATA$age[DATA$hmw.lmw=="HMW"],DATA$age[DATA$hmw.lmw=="LMW"])
t.test(DATA$age[DATA$hmw.lmw=="HMW"],DATA$age[DATA$hmw.lmw=="LMW"],na.rm=TRUE,var.equal = TRUE)
boxplot(DATA$age~DATA$hmw.lmw,col=wes_palette(n=2,name = "GrandBudapest1"),ylab = "age",xlab = "statut HMW/LMW",axes=FALSE, main=("age selon le type d'agent"))
axis(side=1,at=c(1,2),labels =c("HMW","LMW") )
legend("topright",legend = c("HMW","LMW"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
```

### Sex

```{r}
DATA$sex<-factor(DATA$sex)
by(DATA$sex,DATA$hmw.lmw,table)
tab<-table(DATA$sex,DATA$hmw.lmw)
cprop(tab)
chisq.test(tab)
b<-cprop(tab)[1:2,1:3]
colnames(b)<-rep("",3)
barplot(b,beside=TRUE,ylab="pourcentage ",xlab = "type d'agent",main="repartition par sex",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE,xlim=c(0,10),ylim=c(0,110))
axis(side=1,at=c(2,5,8),labels = c("HMW","LMW","ensemble"))
axis(side=2)
legend("topright",legend = c("femme","homme"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)

```

### IMC

```{r}
by(DATA$bmi,DATA$hmw.lmw,summary)
boxplot(DATA$bmi~DATA$hmw.lmw,xlab = "phenotype",ylab = 'bmi en kg/m2',main="Repartition BMI selon le phenotype",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("HMW","LMW") )
legend("topright",legend = c("HMW","LMW"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
var.test(DATA$bmi[DATA$hmw.lmw=="HMW"],DATA$bmi[DATA$hmw.lmw=="LMW"])
t.test(DATA$bmi[DATA$hmw.lmw=="HMW"],DATA$bmi[DATA$hmw.lmw=="LMW"],na.rm=TRUE,var.equal = TRUE)
t.test(DATA$bmi[DATA$hmw.lmw=="HMW"],DATA$bmi[DATA$hmw.lmw=="LMW"],na.rm=TRUE,var.equal = FALSE)

```

### Tabagisme

```{r}
tabsm<-table(DATA$smoker,DATA$hmw.lmw)
cprop(tabsm)
c<-cprop(tabsm)[1:3,1:3]
colnames(c)<-rep("",3)
barplot(c,beside=TRUE,xlab = "phenotype", ylab = "pourcentage",main = "statut tabagique",col=wes_palette(n=3,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at= c(3,7,11),labels=c("HMW","LMW","ensemble"))
legend("topleft",legend = c("current","ex","never"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1)
axis(side=2)
chisq.test(tabsm)

```

### Niveau d'éducation

```{r}
DATA$education<-factor(DATA$education,c("primary","secondary","post-secondary"))
tabe<-table(DATA$education,DATA$hmw.lmw)
d<-cprop(tabe)[1:3,1:3]
colnames(d)<-rep("",3)
barplot(d,beside=TRUE,xlab = "phenotype",ylab = "pourcentage",main="niveau d'education selon le phenotype",col=wes_palette(n=3,name = "GrandBudapest1"),axes = FALSE,xlim=c(0,15),ylim=c(0,100))
axis(side=1,at=c(3,7,11),labels=c("HMW","LMW","ensemble"))
legend("topleft",legend=c("primary","secondary","post-secondary"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1)
axis(side=2)
cprop(tabe)
chisq.test(tabe)
```


### Atopie

```{r}
taba<-table(DATA$atopy,DATA$hmw.lmw)
taba
cprop(taba)
e<-(cprop(taba)[1:2,1:3])
colnames(e)<-rep("",3)
barplot(e,beside=TRUE,xlab="phenotype",ylab="pourcentage",main="type d'agent et atopie",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE,ylim = c(0,70))
axis(side=1,at= c(2,5,8),labels=c("HMW","LMW","ensemble"))
legend("topright",legend =c("pas atopique","atopique"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1 )
 
chisq.test(taba)

```


### Presence d'IgE specifique ou prick test

```{r}
barplotHL<-function(a,b,c,d,e,f){
  
  colnames(a) <- rep("",3)
  barplot(a,beside=TRUE,xlab="phenotype",ylab="pourcentage",main=b,col=wes_palette(n=c,name = "GrandBudapest1"),axes=FALSE,ylim=c(0,d))
  axis(side=1,at=e,labels=c("HMW","LMW","ensemble"))
  legend("topright",legend = f,col=wes_palette(n=c,name = "GrandBudapest1"),lty = 1)
  axis(side=2)
}
tabige<-table((DATA$ige_mediated_oa[DATA$ige_mediated_oa!="not performed"]),DATA$hmw.lmw[DATA$ige_mediated_oa!="not performed"])
tabige
DATA$ige_mediated_oa<-factor(DATA$ige_mediated_oa)
cprop(tabige)
barplotHL(a=cprop(tabige)[1:2,1:3],b="IgE spe ou prick selon le type d'agent",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabige)
```


### Présence d'un asthme antérieur

```{r}
tabpre<-table(DATA$asthma_pre,DATA$hmw.lmw)
tabpre
cprop(tabpre)
barplotHL(a=cprop(tabpre)[1:2,1:3],b=("Relation entre le type d'agent et la preexistance d'un asthme"),c=2,d=100,e=(c(2,5,8)),f=(c("non","oui")))
chisq.test(tabpre)
```

### Toux

```{r}
tabcw<-table(DATA$cough_w,DATA$hmw.lmw)
tabcw
cprop(tabcw)
barplotHL(a=cprop(tabcw)[1:2,1:3],b="type d'agent et toux",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabcw)

```

### Présence de sifflement

```{r}
tabww<-table(DATA$wheezing_w,DATA$hmw.lmw)
tabww
cprop(tabww)
barplotHL(a=cprop(tabww)[1:2,1:3],b="sifflement et type d'agent",c=2,d=100,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabww)
```

### Dyspnée

```{r}
tabdw<-table(DATA$dyspnea_w,DATA$hmw.lmw)
tabdw
cprop(tabdw)
barplotHL(a=cprop(tabdw)[1:2,1:3],b="dyspnee et type d'agent",c=2,d=120,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabdw)
```

###Serrement

```{r}
tabtw<-table(DATA$tightness_w,DATA$hmw.lmw)
tabtw
cprop(tabtw)
barplotHL(a=cprop(tabtw)[1:2,1:3],b="serrement et type d'agent",c=2,d=100,e=c(2,5,8),f=c("non","yes"))
chisq.test(tabtw)
```

###Crachat

```{r}
tabspw<-table(DATA$sputum,DATA$hmw.lmw)
tabspw
cprop(tabspw)
barplotHL(a=cprop(tabspw)[1:2,1:3],b="crachat au travail selon le type d'agent",c=2,d=100,e=c(2,5,8),f=c("no","yes"))
chisq.test(tabspw)
```

###Rhinite

```{r}
tabrw<-table(DATA$rhinitis_w,DATA$hmw.lmw)
tabrw
cprop(tabrw)
barplotHL(a=cprop(tabrw)[1:2,1:3],b="rhinite au travail selon le type d'agent",c=2,d=100,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabrw)
```

###Debut rhinite

```{r}
DATA$onset_of_rhinitis_w<-as.character(DATA$onset_of_rhinitis_w)
taborw<-taborw<-table((DATA$onset_of_rhinitis_w[DATA$onset_of_rhinitis_w!="not applicable"]),DATA$hmw.lmw[DATA$onset_of_rhinitis_w!="not applicable"])
taborw
DATA$onset_of_rhinitis_w<-factor(DATA$onset_of_rhinitis_w)
cprop(taborw)
barplotHL(a = cprop(taborw)[1:3,1:3],b= "apparition rhinite au travail selon le phenotype",c=3,d=80,e=c(4,7,10),f=c("after","at the same time","before") )
chisq.test(taborw)
```


###conjonctivite

```{r}
tab2<-table(DATA$conjonct_w,DATA$hmw.lmw)
cprop(tab2)
barplotHL(a =cprop(tab2)[1:2,1:3],b="conjonctivite au travail selon le type d'agent",c=2,d=80,e= c(2,5,8),f=c("non","oui"))
chisq.test(tab2)

```

###eczema

```{r}
tabec<-table(DATA$eczema_w,DATA$hmw.lmw)
tabec
cprop(tabec)
barplotHL(a =cprop(tabec)[1:2,1:3],b="eczema au travail selon le type d'agent",c=2,d=110,e=c(2,5,8),f=c("non","oui") )
chisq.test(tabec)
```

###urticaire

```{r}
taburt<-table(DATA$urticaria_w,DATA$hmw.lmw)
taburt
cprop(taburt)
barplotHL(a=cprop(taburt)[1:2,1:3],b="urticaire au travail selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(taburt)
```

###Dysphonie

```{r}
tabdys<-table(DATA$dysphonia_w,DATA$hmw.lmw)
tabdys
cprop(tabdys)
barplotHL(a=cprop(tabdys)[1:2,1:3],b="dysphonie au travail selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabdys)
```

###Sinusite

```{r}
tabsin<-table(DATA$sinusitis,DATA$hmw.lmw)
tabsin
cprop(tabsin)
barplotHL(a=cprop(tabsin)[1:2,1:3],b="sinusite selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabsin)

```


###Délai d'apparition de l'asthme

```{r}
by(DATA$asthma_delay,DATA$T2,summary)
boxplot(DATA$asthma_delay~DATA$T2,ylab = "delai d'apparition de l'asthme en mois",xlab = "phenotype",main="delai d'apparition de l'asthme selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
#verification de l normalite de distribution des populations
hist(DATA$asthma_delay[DATA$T2==0])
qqnorm(DATA$asthma_delay[DATA$T2==0])
shapiro.test(DATA$asthma_delay[DATA$T2==0])
#recherche de normalite apres transformation logarythmique
hist(log(DATA$asthma_delay[DATA$T2==0]))
#recherche d'egalite des variances
var.test(DATA$asthma_delay[DATA$T2==0],DATA$asthma_delay[DATA$T2==1])
wilcox.test(DATA$asthma_delay[DATA$T2==0],DATA$asthma_delay[DATA$T2==1],var.equal = TRUE,na.rm=TRUE)
```

###Age d'apparition de l'asthme

```{r}
summary(DATA$age_onset_cat)
tabonset<-table(DATA$age_onset_cat,DATA$T2)
tabonset
cprop(tabonset)
barplotNM(a=cprop(tabonset)[1:3,1:3],b="age d'apparition de l'asthme selon le phenotype",c=3,d=130,e=c(4,7,10),f=c("<12 and","12-18 ans",">18 ans"))

chisq.test(tabonset)

```

###Durée des symptomes au travail en mois

```{r}
summary(DATA$asthma_work_time)
hist(DATA$asthma_work_time[DATA$T2==1],breaks = 300)
by(DATA$asthma_work_time,DATA$T2,summary)
boxplot(DATA$asthma_work_time~DATA$T2,xlab = "phenotype",ylab = "temps de travail avec symptomes en mois",main="temps de travail avec symptomes selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
var.test(DATA$asthma_work_time[DATA$T2==0],DATA$asthma_work_time[DATA$T2==1])
t.test(DATA$asthma_work_time,DATA$T2,var.equal = FALSE,na.rm=TRUE)
t.test(DATA$asthma_work_time,DATA$T2,var.equal = TRUE,na.rm=TRUE)
wilcox.test(DATA$asthma_work_time,DATA$T2,na.rm=TRUE)

```

###délai depuis la dernière exposition

```{r}
summary(DATA$time_last_exp_m)
DATA$time_last_exp_m<-as.numeric(DATA$time_last_exp_m)
by(DATA$time_last_exp_m,DATA$T2,summary)
hist(DATA$time_last_exp_m[DATA$T2==0],breaks=100)
boxplot(DATA$time_last_exp_m~DATA$T2,xlab="phenotype",ylab="nombre de mois depuis la dernière exposition",main="rapport entre le phenotype et a derniere exposition",col=wes_palette("GrandBudapest1",2),axes=FALSE,ylim=c(0,120))
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
var.test(DATA$time_last_exp_m[DATA$T2==1],DATA$time_last_exp_m[DATA$T2==0])
t.test(DATA$time_last_exp_m[DATA$T2==1],DATA$time_last_exp_m[DATA$T2==0],var.equal = TRUE,na.rm=TRUE)
wilcox.test(DATA$time_last_exp_m[DATA$T2==1],DATA$time_last_exp_m[DATA$T2==0],na.rm=TRUE)
```

###utilisation des SABA

```{r}
summary(DATA$saba_w_frequency)
DATA$saba_w_frequency<-factor(DATA$saba_w_frequency,c("?3 times a day","1 or 2 times a day","2 or more times a week","once or less per week","never"))
tabsa<-table(DATA$saba_w_frequency,DATA$T2)
tabsa
cprop(tabsa)
g<-cprop(tabsa)[1:5,1:3]
colnames(g)<-rep("",3)
barplot(g,beside=TRUE,xlab="phenotype",ylab = " utilisation de SABA", main="utilisation de SABA selon le phenotype",axes=FALSE,ylim =c(0,80),col=wes_palette(n=5,name = "BottleRocket1"))
axis(side=1,at=c(3,9,15),labels =c("noT2","T2","ensemble") )
axis(side=2)
legend("topright",legend = c(">3 fois par jours","1 à 2 fois par jours","2 fois ou plus par semaines","une fois par semaine ou moins","jamais"),col=wes_palette(n=5,name = "BottleRocket1"),lty = 1)

chisq.test(tabsa)

```

###utilisation des ICS

```{r}
summary(DATA$ics_w_gina)
DATA$ics_w_gina<-factor(DATA$ics_w_gina,c("high","medium","low","no ICS"))
tabics<-table(DATA$ics_w_gina,DATA$T2)
tabics
cprop(tabics)
barplotNM(a=cprop(tabics)[1:4,1:3],b="utilisation des ICS selon le phenotype",c=4,d=80,e=c(3,8,13),f=c("haut","moyen","bas","pas de CSI"))
chisq.test(tabics)
```

###utilisation des laba

```{r}
summary(DATA$laba_w)
tabala<-table(DATA$laba_w,DATA$T2)
tabala
cprop(tabala)
barplotNM(a=cprop(tabala)[1:2,1:3],b="utilisation de laba selon le phenotype",c=2,d=80,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabala)
```

###utilisation des leukotriène

```{r}
summary(DATA$ltra_w)
tabltra<-table(DATA$ltra_w,DATA$T2)
tabltra
cprop(tabltra)
barplotNM(a=cprop(tabltra)[1:2,1:3],b="utilisation de leucotriene selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabltra)
```

###corticoide oraux

```{r}
summary(DATA$ocs_w)
#transformation en variable dichotomique:
DATA$ocs_w_nb<-ifelse(DATA$ocs_w_dose==0,"no","yes")
table(DATA$ocs_w_nb)
tabocs<-table(DATA$ocs_w_nb,DATA$T2)
cprop(tabocs)
tabocs
barplotNM(a=cprop(tabocs)[1:2,1:3],b="utilisation de CSO selon le phenotype",c=2,d=125,e=c(2,5,8),f=c("non","oui"))
"utilisation du test exact de fischer car effectif attendu de petite taille"
fisher.test(tabocs)
```

###anti-histaminique

```{r}
summary(DATA$anti_h1_w)
tabhist<-table(DATA$anti_h1_w,DATA$T2)
tabhist
cprop(tabhist)
barplotNM(a=cprop(tabhist)[1:2,1:3],b="utilisation d'anti-histaminique selon le phenotype",c=2,d=100,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabhist)
```

###corticoide nasaux

```{r}
summary(DATA$ncs_w)
tabncs<-table(DATA$ncs_w,DATA$T2)
tabncs
cprop(tabncs)
barplotNM(a=cprop(tabncs)[1:2,1:3],b="utilisation d'anti-histaminique nasaux selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabncs)
```

###sévérite GINA

```{r}
summary(DATA$severity_asthma_gina_w)
DATA$severity_asthma_gina_w<-factor(DATA$severity_asthma_gina_w,c("severe","moderate","mild","no treatment"))
tabgin<-table(DATA$severity_asthma_gina_w,DATA$T2)
tabgin
cprop(tabgin)
barplotNM(a=cprop(tabgin)[1:4,1:3],b="stade de severite selon le GINA",c=4,d=60,e=c(3,8,13),f=c("severe","modere","leger","non traite"))
chisq.test(tabgin)
```

###exacerbation

```{r}
summary(DATA$exacerbation_w)
#transformation en variable dichotomique (plus d'une exacerbation ou pas)
DATA$exacerbation_w_nb<-ifelse(DATA$exacerbation_w==0,"no","yes")
DATA$exacerbation_w_nb<-factor(DATA$exacerbation_w_nb)
summary(DATA$exacerbation_w_nb)
tabex<-table(DATA$exacerbation_w_nb,DATA$T2)
tabex
cprop(tabex)
barplotNM(a=cprop(tabex)[1:2,1:3],b="exacerbation l'année precedente selon le phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabex)
```

###non control selon le GINA (création nouvelle variable: non controlé si au moins une exacerbation sévère ou plus de 2 utilisation de SABA par semaine)

```{r}
DATA$uncontrolled_gina_w<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$asthma_control_w[i]) | is.na(DATA$exacerbation_w_nb[i])) {
    DATA$uncontrolled_gina_w[i] <- NA
  }
  
  if( (!is.na(DATA$asthma_control_w[i]) & !is.na(DATA$exacerbation_w_nb[i])) & DATA$asthma_control_w[i]=="asthma controlled" & DATA$exacerbation_w_nb[i]=="no"){
    DATA$uncontrolled_gina_w[i] <- "no"
  }
  if( (!is.na(DATA$asthma_control_w[i]) & !is.na(DATA$exacerbation_w_nb[i])) & (DATA$asthma_control_w[i]=="asthma uncontrolled" | DATA$exacerbation_w_nb[i]=="yes")){
    DATA$uncontrolled_gina_w[i] <- "yes"
  }
}

tabcont<-table(DATA$uncontrolled_gina_w,DATA$T2)
tabcont
cprop(tabcont)
barplotNM(a=cprop(tabcont)[1:2,1:3],b="asthme non controlé",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabcont)

```


###VEMS

```{r}
summary(DATA$baseline_fev1)
by(DATA$baseline_fev1,DATA$T2,summary)
boxplot(DATA$baseline_fev1~DATA$T2,xlab = "phenotype",ylab = "VEMS de base",main="VEMS selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE,ylim=c(0,180))
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$baseline_fev1[DATA$T2==1],breaks=200)
hist(DATA$baseline_fev1[DATA$T2==0],breaks=200)
var.test(DATA$baseline_fev1[DATA$T2==0],DATA$baseline_fev1[DATA$T2==1])
t.test(DATA$baseline_fev1[DATA$T2==0],DATA$baseline_fev1[DATA$T2==1],var.equal = TRUE,na.rm=TRUE)
```

###VEMS<80%

```{r}
summary(DATA$baseline_fev1.80.)
tabfev<-table(DATA$baseline_fev1.80.,DATA$T2)
tabfev
cprop(tabfev)
barplotNM(a =cprop(tabfev)[1:2,1:3],b=" VEMS<80% selon le phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabfev)
```

###Tiffeneau

```{r}
summary(DATA$fev1.fvc)
by(DATA$fev1.fvc,DATA$T2,summary)
boxplot(DATA$fev1.fvc~DATA$T2,xlab = "phenotype",ylab = "coefficient de Tiffeneau",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$fev1.fvc[DATA$T2==1],breaks = 300)
hist(DATA$fev1.fvc[DATA$T2==0],breaks = 300)
qqnorm(DATA$fev1.fvc[DATA$T2==1])
var.test(DATA$fev1.fvc[DATA$T2==1],DATA$fev1.fvc[DATA$T2==0])
t.test(DATA$fev1.fvc[DATA$T2==1],DATA$fev1.fvc[DATA$T2==0],na.rm=TRUE)
```

###Trouble Ventilatoire obstructif

```{r}
summary(DATA$airway_obstruction)
tabobs<-table(DATA$airway_obstruction,DATA$T2)
tabobs
cprop(tabobs)
barplotNM(a=cprop(tabobs)[1:2,1:3],b="obstruction bronchique selon phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabobs)
```

###niveau d'hyper-réactivité bronchique selon le phenotype
```{r}
table(DATA$nsbh_grade)
tabgrad<-table(DATA$nsbh_grade,DATA$T2)
tabgrad
cprop(tabgrad)
barplotNM(a=cprop(tabgrad)[1:3,1:3],b="niveau d'HRB selon le phénotype",c=3,d=80,e=c(2,6,10),f=c("absent","modere","severe"))
chisq.test(tabgrad)
```



###Changement Hyper-reactivite bronchique 

```{r}
summary(DATA$nsbh_sic_ratio)
by(DATA$nsbh_sic_ratio,DATA$T2,summary)
boxplot(DATA$nsbh_sic_ratio~DATA$T2,xlab = "phenotype",ylab = "ratio de test d'hyperreactivite bronchique",main="ratio de test d'hyperreactivite bronchique selon le phenotype",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$nsbh_sic_ratio[DATA$T2==1],breaks = 400)
hist(DATA$nsbh_sic_ratio[DATA$T2==0],breaks = 400)
var.test(DATA$nsbh_sic_ratio[DATA$T2==1],DATA$nsbh_sic_ratio[DATA$T2==0])
wilcox.test(DATA$nsbh_sic_ratio[DATA$T2==1],DATA$nsbh_sic_ratio[DATA$T2==0])
```

###Ratio d'HRB>2

```{r}
summary(DATA$nsbh_sic_max_ratio)
tabrat<-table(DATA$nsbh_sic_max_ratio,DATA$T2)
tabrat
cprop(tabrat)
barplotNM(a=cprop(tabrat)[1:2,1:3],b="taux de ration d'hyper reactivite bronchique superieur a 2 et phenotype",c=2,d=75,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabrat)
```


###Reponse immediate

```{r}
summary(DATA$early_reaction)
tabear<-table(DATA$early_reaction,DATA$T2)
tabear
cprop(tabear)
barplotNM(a=cprop(tabear)[1:2,1:3],b="nombre de reaction precoce selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabear)
```

###reponse tardif

```{r}
summary(DATA$late_reaction)
tablat<-table(DATA$late_reaction,DATA$T2)
tablat
cprop(tablat)
barplotNM(a=cprop(tablat)[1:2,1:3],b="nombre de reaction tardive selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(tablat)
```

###reponse precoce uniquement

```{r}
#creation de la variable d'interet avec une boucle for
DATA$only_early<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$early_reaction[i]) & is.na(DATA$late_reaction[i])) {
    DATA$only_early[i] <- NA
  }
  if(is.na(DATA$early_reaction[i]) | is.na(DATA$late_reaction[i])) {
    DATA$only_early[i] <- NA
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & DATA$early_reaction[i]=="yes" & DATA$late_reaction[i]=="no"){
    DATA$only_early[i] <- "yes"
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & (DATA$early_reaction[i]!="yes" | DATA$late_reaction[i]!="no")){
    DATA$only_early[i] <- "no"
  }
}

DATA$only_early<-factor(DATA$only_early)
summary(DATA$only_early)
tabonear<-table(DATA$only_early,DATA$T2)
tabonear
cprop(tabonear)
barplotNM(a=cprop(tabonear)[1:2,1:3],b="nombre de reaction precoce uniquement selon le phenotype",c="2",d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabonear)

```


###reponse tardive uniquement

```{r}
#creation de la variablepar boucle for

DATA$only_late<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$early_reaction[i]) | is.na(DATA$late_reaction[i])) {
    DATA$only_late[i] <- NA
  }
  
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & DATA$early_reaction[i]=="no" & DATA$late_reaction[i]=="yes"){
    DATA$only_late[i] <- "yes"
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & (DATA$early_reaction[i]!="no" | DATA$late_reaction[i]!="yes")){
    DATA$only_late[i] <- "no"
  }
}
DATA$only_late<-factor(DATA$only_late)
summary(DATA$only_late)
tabonlate<-table(DATA$only_late,DATA$T2)
tabonlate
cprop(tabonlate)
barplotNM(a=cprop(tabonlate)[1:2,1:3],b="nombre de reaction tardive uniquement selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabonlate)
```




###reponse precoce et tardive

```{r}
#creation de la variable par boucle for
DATA$early_late<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$early_reaction[i]) | is.na(DATA$late_reaction[i])) {
    DATA$early_late[i] <- NA
  }
  
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & DATA$early_reaction[i]=="yes" & DATA$late_reaction[i]=="yes"){
    DATA$early_late[i] <- "yes"
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & (DATA$early_reaction[i]=="no" | DATA$late_reaction[i]=="no")){
    DATA$early_late[i] <- "no"
  }
}

DATA$early_late<-factor(DATA$early_late)
summary(DATA$early_late)

taboth<-table(DATA$early_late,DATA$T2)
taboth
cprop(taboth)
barplotNM(a=cprop(taboth)[1:2,1:3],b="proportion de reaction mixte selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(taboth)
```



###expecto pre SIC neutrophile

```{r}
summary(DATA$neutro_pre_sic)
by(DATA$neutro_pre_sic,DATA$T2,summary)
boxplot(DATA$neutro_pre_sic~DATA$T2,xlab = "phenotype",ylab = "% neutro au expectoration",main="%neutro dans les expectoration selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE,ylim=c(0,150))
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$neutro_pre_sic[DATA$T2==1],breaks = 100)
hist(DATA$neutro_pre_sic[DATA$T2==0],breaks = 100)
qqnorm(DATA$neutro_pre_sic[DATA$T2==1])
qqnorm(DATA$neutro_pre_sic[DATA$T2==0])
shapiro.test(DATA$neutro_pre_sic[DATA$T2==1])
shapiro.test(DATA$neutro_pre_sic[DATA$T2==0])
var.test(DATA$neutro_pre_sic[DATA$T2==0],DATA$neutro_pre_sic[DATA$T2==1])
t.test(DATA$neutro_pre_sic[DATA$T2==0],DATA$neutro_pre_sic[DATA$T2==1],var.equal = TRUE,na.rm=TRUE)
```

###expecto pre SIC >/=76% neutro

```{r}
summary(DATA$neutro_pre_sic.76)
tabneu<-table(DATA$neutro_pre_sic.76,DATA$T2)
tabneu
cprop(tabneu)
barplotNM(a=cprop(tabneu)[1:2,1:3],b=" proportion de neutrophile sup ou egale a 76% selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabneu)
```


###expecto pre SIC >/= 61% neutro

```{r}
tabneu61<-table(DATA$neutro_pre_sic.61,DATA$T2)
tabneu61
cprop(tabneu61)
barplotNM(a =cprop(tabneu61)[1:2,1:3],b=" proportion de neutrophile sup ou egale a 61% selon le phenotype",c="2",d=90,e=c(2,5,8),f=c("non","oui") )

chisq.test(tabneu)
```


###changement de neutrophile au expecto pendant le SIC

```{r}
summary(DATA$change_neutro)
by(DATA$change_neutro,DATA$T2,summary)
boxplot(DATA$change_neutro~DATA$T2,xlab = "phenotype",ylab = "changement de neutrophile dans les expectorations",main="changement de neutrophile dans les expectorations selon le phenotype",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$change_neutro[DATA$T2==1],breaks = 75)
hist(DATA$change_neutro[DATA$T2==0],breaks = 75)
var.test(DATA$change_neutro[DATA$T2==0],DATA$change_neutro[DATA$T2==1])
t.test(DATA$change_neutro[DATA$T2==0],DATA$change_neutro[DATA$T2==1],var.equal = TRUE,na.rm=TRUE)
```

###changement de FeNO pendant le SIC

```{r}
summary(DATA$change_feno.17.5ppb)
tabfeno<-table(DATA$change_feno.17.5ppb,DATA$T2)
tabfeno
cprop(tabfeno)
barplotNM(a=cprop(tabfeno)[1:2,1:3],b="changement de FeNO sup ou egal à 17.5% selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabfeno)
```


###changement des eosino expecto post SIC

```{r}
summary(DATA$change_eosino.3)
tabcheo<-table(DATA$change_eosino.3,DATA$T2)
tabcheo
cprop(tabcheo)
barplotNM(a=cprop(tabcheo)[1:2,1:3],b="changement d'Eo dans les expecto sup ou egal a 3% selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))

```


###profil d'inflammation pre SIC eosinophilique pur (cut off neutro à 61)

```{r}
#creation de la variable par boucle for
DATA$pre_eosino<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_pre_sic.3[i]) | is.na(DATA$neutro_pre_sic.61[i])) {
    DATA$pre_eosino[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & DATA$eosino_pre_sic.3[i]=="yes" & DATA$neutro_pre_sic.61[i]=="no"){
    DATA$pre_eosino[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & (DATA$eosino_pre_sic.3[i]!="yes" | DATA$neutro_pre_sic.61[i]!="no")){
    DATA$pre_eosino[i] <- "no"
  }
}
DATA$pre_eosino<-factor(DATA$pre_eosino)
#analyse descriptive
tabpreo<-table(DATA$pre_eosino,DATA$T2)
tabpreo
cprop(tabpreo)
barplotNM(a =cprop(tabpreo)[1:2,1:3],b="profil sputum pre sic eosino strict par phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui","ensemble") )
chisq.test(tabpreo)

```

###profil neutro pre sic (cut off 61)

```{r}
#création de la variable
DATA$pre_neutro<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$neutro_pre_sic.61[i])|is.na(DATA$eosino_pre_sic.3[i])){
    DATA$pre_neutro[i]<-NA
  }
  if((!is.na(DATA$neutro_pre_sic.61[i]) & !is.na(DATA$eosino_pre_sic.3[i])) & (DATA$neutro_pre_sic.61[i]=="yes" & DATA$eosino_pre_sic.3[i]=="no")){
    DATA$pre_neutro[i]<-"yes"
  }
  if((!is.na(DATA$neutro_pre_sic.61[i]) & !is.na(DATA$eosino_pre_sic.3[i])) & (DATA$neutro_pre_sic.61[i]!="yes" & DATA$eosino_pre_sic.3[i]!="no")){
    DATA$pre_neutro[i]<-"no"
}
}
#descriptif
tabpreneu<-table(DATA$pre_neutro,DATA$T2)
tabpreneu
cprop(tabpreneu)
by(DATA$pre_neutro,DATA$T2,summary)
barplotNM(a=cprop(tabpreneu)[1:2,1:3],b="profil sputum neutro strict selon le phenotype",c=2,d=130,e=c(2,5,8),f=c("non","yes"))
chisq.test(tabpreneu)
```

###profil mixed granulocytic

```{r}
#creation de la variable par boucle for
DATA$pre_mixte<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_pre_sic.3[i]) | is.na(DATA$neutro_pre_sic.61[i])) {
    DATA$pre_mixed[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & DATA$eosino_pre_sic.3[i]=="yes" & DATA$neutro_pre_sic.61[i]=="yes"){
    DATA$pre_mixed[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & (DATA$eosino_pre_sic.3[i]!="yes" | DATA$neutro_pre_sic.61[i]!="yes")){
    DATA$pre_mixed[i] <- "no"
  }
}
#descriptif
tabpremix<-table(DATA$pre_mixed,DATA$T2)
by(DATA$pre_mixed,DATA$T2,table)
DATA$pre_mixed<-factor(DATA$pre_mixed)
cprop(tabpremix)
barplotNM(a=cprop(tabpremix)[1:2,1:3],b="profil sputum mixed granulocytique selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("no","yes"))
chisq.test(tabpremix)
```

###profil pre paucigranulocytic

```{r}
DATA$pre_pauci<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_pre_sic.3[i]) | is.na(DATA$neutro_pre_sic.61[i])) {
    DATA$pre_pauci[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & DATA$eosino_pre_sic.3[i]=="no" & DATA$neutro_pre_sic.61[i]=="no"){
    DATA$pre_pauci[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & (DATA$eosino_pre_sic.3[i]!="no" | DATA$neutro_pre_sic.61[i]!="no")){
    DATA$pre_pauci[i] <- "no"
  }
}
tabprepauci<-table(DATA$pre_pauci,DATA$T2)
by(DATA$pre_pauci,DATA$T2,summary)
cprop(tabprepauci)
barplotNM(a=cprop(tabprepauci)[1:2,1:3],b="profil sputum paucigranulocytique selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("no","yes"))
chisq.test(tabprepauci)

```





#Analyse de la cohorte EUPHOCAS, projet T2/non T2/ critère T2 Feno25


##creation de la variable T2_25

```{r}
DATA$T2_25<-ifelse(test = (DATA$blood_eosino_300=="yes"&!is.na(DATA$blood_eosino_300))|(DATA$feno_pre_sic.25=="yes"&!is.na(DATA$feno_pre_sic.25))|(DATA$eosino_pre_sic.3=="yes"&!is.na(DATA$eosino_pre_sic.3)),1,0 )
DATA$T2_25<-ifelse(test=(is.na(DATA$blood_eosino_300))&(is.na(DATA$feno_pre_sic.25))&(is.na(DATA$eosino_pre_sic.3)),NA,DATA$T2_25)
```


##Analyse descriptive des echantillons selon T2 ou non T2 

####age.2 

```{r}
table(DATA$T2_25)
by(DATA$age,DATA$T2_25,summary)
var.test(DATA$age[DATA$T2_25==1],DATA$age[DATA$T2_25==0])
t.test(DATA$age[DATA$T2_25==1],DATA$age[DATA$T2_25==0],na.rm=TRUE,var.equal = TRUE)
boxplot(DATA$age~DATA$T2_25,col=wes_palette(n=2,name = "GrandBudapest1"),ylab = "age",xlab = "statut T2",axes=FALSE, main=("age selon le phenotype"))
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("noT2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
```

###sex.2

```{r}
DATA$sex<-factor(DATA$sex)
by(DATA$sex,DATA$T2_25,table)
tab<-table(DATA$sex,DATA$T2_25)
cprop(tab)
chisq.test(tab)
b<-cprop(tab)[1:2,1:3]
colnames(b)<-rep("",3)
barplot(b,beside=TRUE,ylab="pourcentage ",xlab = "phenotypage T2_25",main="repartition par sex",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE,xlim=c(0,10),ylim=c(0,110))
axis(side=1,at=c(2,5,8),labels = c("no T2","T2_25","ensemble"))
axis(side=2)
legend("topright",legend = c("femme","homme"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)

```

###BMI.2

```{r}
by(DATA$bmi,DATA$T2_25,summary)
boxplot(DATA$bmi~DATA$T2_25,xlab = "phenotype",ylab = 'bmi en kg/m2',main="Repartition BMI selon le phenotype",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2_25") )
legend("topright",legend = c("no T2","T2_25"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
var.test(DATA$bmi[DATA$T2_25==1],DATA$bmi[DATA$T2_25==0])
var(DATA$bmi[DATA$T2_25==1],na.rm=TRUE)
var(DATA$bmi[DATA$T2_25==0],na.rm=TRUE)
t.test(DATA$bmi[DATA$T2_25==1],DATA$bmi[DATA$T2_25==0],na.rm=TRUE,var.equal = TRUE)
t.test(DATA$bmi[DATA$T2_25==1],DATA$bmi[DATA$T2_25==0],na.rm=TRUE,var.equal = FALSE)

```

### Tabagisme.2

```{r}
tabsm<-table(DATA$smoker,DATA$T2_25)
cprop(tabsm)
c<-cprop(tabsm)[1:3,1:3]
colnames(c)<-rep("",3)
barplot(c,beside=TRUE,xlab = "phenotype", ylab = "pourcentage",main = "statut tabagique",col=wes_palette(n=3,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at= c(3,7,11),labels=c("no T2","T2_25","ensemble"))
legend("topleft",legend = c("current","ex","never"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1)
axis(side=2)
chisq.test(tabsm)

```

###Niveau d'éducation

```{r}
DATA$education<-factor(DATA$education,c("primary","secondary","post-secondary"))
tabe<-table(DATA$education,DATA$T2_25)
d<-cprop(tabe)[1:3,1:3]
colnames(d)<-rep("",3)
barplot(d,beside=TRUE,xlab = "phenotype",ylab = "pourcentage",main="niveau d'education selon le phenotype",col=wes_palette(n=3,name = "GrandBudapest1"),axes = FALSE,xlim=c(0,15),ylim=c(0,100))
axis(side=1,at=c(3,7,11),labels=c("no T2","T2_25","ensemble"))
legend("topleft",legend=c("primary","secondary","post-secondary"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1)
axis(side=2)
cprop(tabe)
chisq.test(tabe)
```

###Atopie.2

```{r}
taba<-table(DATA$atopy,DATA$T2_25)
taba
cprop(taba)
e<-(cprop(taba)[1:2,1:3])
colnames(e)<-rep("",3)
barplot(e,beside=TRUE,xlab="phenotype",ylab="pourcentage",main="phenotype T2 et atopie",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE,ylim = c(0,70))
axis(side=1,at= c(2,5,8),labels=c("no T2","T2_25","ensemble"))
legend("topright",legend =c("pas atopique","atopique"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1 )
axis(side=2) 
chisq.test(taba)

```


###Classification bas poids moléculaire/haut poids moléculaire.2

```{r}
tabw<-table(DATA$hmw.lmw,DATA$T2_25)
tabw
cprop(tabw)
f<-cprop(tabw)[1:2,1:3]
colnames(f)<-rep("",3)
barplot(f,beside=TRUE,xlab = "phenotype",ylab="pourcentage",main = "Statut HMW/LMW en fonction du phenotype T2/noT2",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE,ylim = c(0,70))
axis(side=1,at= c(2,5,8),labels=c("no T2","T2_25","ensemble"))
axis(side=2)
legend("topright",legend =c("HMW","LMW"),col=wes_palette(n=3,name = "GrandBudapest1"),lty=1 )
chisq.test(tabw)
```

### Presence d'IgE specifique ou prick test.2

```{r}
DATA$ige_mediated_oa<-as.character(DATA$ige_mediated_oa)
tabige<-table((DATA$ige_mediated_oa[DATA$ige_mediated_oa!="not performed"]),DATA$T2_25[DATA$ige_mediated_oa!="not performed"])
tabige
DATA$ige_mediated_oa<-factor(DATA$ige_mediated_oa)
cprop(tabige)
barplotNM(a=cprop(tabige)[1:2,1:3],b="IgE spe ou prick selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabige)
```



###Présence d'un asthme antérieur.2

```{r}
tabpre<-table(DATA$asthma_pre,DATA$T2_25)
tabpre
cprop(tabpre)
barplotNM(a=cprop(tabpre)[1:2,1:3],b=("Relation entre le phenotype et la preexistance d'un asthme"),c=2,d=100,e=(c(2,5,8)),f=(c("non","oui")))
chisq.test(tabpre)
```

###Nature de l'agent par catégorie.2

```{r}
tabcat<-table(DATA$agent_category,DATA$T2_25)
tabcat
lprop(tabcat)
```


###Toux.2

```{r}
tabcw<-table(DATA$cough_w,DATA$T2_25)
tabcw
cprop(tabcw)
barplotNM(a=cprop(tabcw)[1:2,1:3],b="phenotype et toux",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabcw)

```

###Présence de sifflement.2

```{r}
tabww<-table(DATA$wheezing_w,DATA$T2_25)
tabww
cprop(tabww)
barplotNM(a=cprop(tabww)[1:2,1:3],b="sifflement et phenotype",c=2,d=100,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabww)
```

###Dyspnée.2

```{r}
tabdw<-table(DATA$dyspnea_w,DATA$T2_25)
tabdw
cprop(tabdw)
barplotNM(a=cprop(tabdw)[1:2,1:3],b="dyspnee et phenotype",c=2,d=120,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabdw)
```

###Serrement.2

```{r}
tabtw<-table(DATA$tightness_w,DATA$T2_25)
tabtw
cprop(tabtw)
barplotNM(a=cprop(tabtw)[1:2,1:3],b="serrement et phenotype",c=2,d=100,e=c(2,5,8),f=c("non","yes"))
chisq.test(tabtw)
```

###Crachat.2

```{r}
tabspw<-table(DATA$sputum,DATA$T2_25)
tabspw
cprop(tabspw)
barplotNM(a=cprop(tabspw)[1:2,1:3],b="crachat au travail selon le phenotype",c=2,d=100,e=c(2,5,8),f=c("no","yes"))
chisq.test(tabspw)
```


###Rhinite.2

```{r}
tabrw<-table(DATA$rhinitis_w,DATA$T2_25)
tabrw
cprop(tabrw)
barplotNM(a=cprop(tabrw)[1:2,1:3],b="rhinite au travail selon le phenotype",c=2,d=100,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabrw)
```

###Debut rhinite.2

```{r}
DATA$onset_of_rhinitis_w<-as.character(DATA$onset_of_rhinitis_w)
taborw<-taborw<-table((DATA$onset_of_rhinitis_w[DATA$onset_of_rhinitis_w!="not applicable"]),DATA$T2_25[DATA$onset_of_rhinitis_w!="not applicable"])
taborw
DATA$onset_of_rhinitis_w<-factor(DATA$onset_of_rhinitis_w)
cprop(taborw)
barplotNM(a = cprop(taborw)[1:3,1:3],b= "apparition rhinite au travail selon le phenotype",c=3,d=80,e=c(4,7,10),f=c("after","at the same time","before") )
chisq.test(taborw)
```

###conjonctivite.2

```{r}
tab2<-table(DATA$conjonct_w,DATA$T2_25)
cprop(tab2)
barplotNM(a =cprop(tab2)[1:2,1:3],b="conjonctivite au travail selon le phenotype",c=2,d=80,e= c(2,5,8),f=c("non","oui"))
chisq.test(tab2)

```

###eczema.2

```{r}
tabec<-table(DATA$eczema_w,DATA$T2_25)
tabec
cprop(tabec)
barplotNM(a =cprop(tabec)[1:2,1:3],b="eczema au travail selon le phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui") )
chisq.test(tabec)
```

###urticaire.2

```{r}
taburt<-table(DATA$urticaria_w,DATA$T2_25)
taburt
cprop(taburt)
barplotNM(a=cprop(taburt)[1:2,1:3],b="urticaire au travail selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(taburt)
```

###Dysphonie.2

```{r}
tabdys<-table(DATA$dysphonia_w,DATA$T2_25)
tabdys
cprop(tabdys)
barplotNM(a=cprop(tabdys)[1:2,1:3],b="dysphonie au travail selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabdys)
```

###Sinusite.2

```{r}
tabsin<-table(DATA$sinusitis,DATA$T2_25)
tabsin
cprop(tabsin)
barplotNM(a=cprop(tabsin)[1:2,1:3],b="sinusite selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabsin)

```

###Délai d'apparition de l'asthme.2

```{r}
by(DATA$asthma_delay,DATA$T2_25,summary)
boxplot(DATA$asthma_delay~DATA$T2_25,ylab = "delai d'apparition de l'asthme en mois",xlab = "phenotype",main="delai d'apparition de l'asthme selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2_25") )
legend("topright",legend = c("no T2","T2_25"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
#verification de l normalite de distribution des populations
hist(DATA$asthma_delay[DATA$T2_25==0])
qqnorm(DATA$asthma_delay[DATA$T2_25==0])
shapiro.test(DATA$asthma_delay[DATA$T2_25==0])
#recherche de normalite apres transformation logarythmique
hist(log(DATA$asthma_delay[DATA$T2_25==0]))
#recherche d'egalite des variances
var.test(DATA$asthma_delay[DATA$T2_25==0],DATA$asthma_delay[DATA$T2_25==1])
wilcox.test(DATA$asthma_delay[DATA$T2_25==0],DATA$asthma_delay[DATA$T2_25==1],var.equal = TRUE,na.rm=TRUE)
```

###Age d'apparition de l'asthme.2

```{r}
tabonset<-table(DATA$age_onset_cat,DATA$T2_25)
tabonset
cprop(tabonset)
barplotNM(a=cprop(tabonset)[1:3,1:3],b="age d'apparition de l'asthme selon le phenotype",c=3,d=130,e=c(4,7,10),f=c("<12 and","12-18 ans",">18 ans"))

chisq.test(tabonset)

```

###Durée des symptomes au travail en mois.2

```{r}
summary(DATA$asthma_work_time)
hist(DATA$asthma_work_time[DATA$T2_25==1],breaks = 300)
by(DATA$asthma_work_time,DATA$T2_25,summary)
boxplot(DATA$asthma_work_time~DATA$T2_25,xlab = "phenotype",ylab = "temps de travail avec symptomes en mois",main="temps de travail avec symptomes selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2_25") )
legend("topright",legend = c("no T2","T2_25"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
var.test(DATA$asthma_work_time[DATA$T2_25==0],DATA$asthma_work_time[DATA$T2_25==1])
t.test(DATA$asthma_work_time,DATA$T2_25,var.equal = FALSE,na.rm=TRUE)
t.test(DATA$asthma_work_time,DATA$T2_25,var.equal = TRUE,na.rm=TRUE)
wilcox.test(DATA$asthma_work_time,DATA$T2_25,na.rm=TRUE)

```

###délai depuis la dernière exposition.2

```{r}
summary(DATA$time_last_exp_m)
DATA$time_last_exp_m<-as.numeric(DATA$time_last_exp_m)
by(DATA$time_last_exp_m,DATA$T2_25,summary)
hist(DATA$time_last_exp_m[DATA$T2_25==0],breaks=100)
boxplot(DATA$time_last_exp_m~DATA$T2_25,xlab="phenotype",ylab="nombre de mois depuis la dernière exposition",main="rapport entre le phenotype et la derniere exposition",col=wes_palette("GrandBudapest1",2),axes=FALSE,ylim=c(0,120))
axis(side=1,at=c(1,2),labels =c("noT2","T2_25") )
legend("topright",legend = c("no T2","T2_25"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
var.test(DATA$time_last_exp_m[DATA$T2_25==1],DATA$time_last_exp_m[DATA$T2_25==0])
t.test(DATA$time_last_exp_m[DATA$T2_25==1],DATA$time_last_exp_m[DATA$T2_25==0],var.equal = TRUE,na.rm=TRUE)
wilcox.test(DATA$time_last_exp_m[DATA$T2_25==1],DATA$time_last_exp_m[DATA$T2_25==0],na.rm=TRUE)
```

###utilisation des SABA.2

```{r}
summary(DATA$saba_w_frequency)
DATA$saba_w_frequency<-factor(DATA$saba_w_frequency,c("?3 times a day","1 or 2 times a day","2 or more times a week","once or less per week","never"))
tabsa<-table(DATA$saba_w_frequency,DATA$T2_25)
tabsa
cprop(tabsa)
g<-cprop(tabsa)[1:5,1:3]
colnames(g)<-rep("",3)
barplot(g,beside=TRUE,xlab="phenotype",ylab = " utilisation de SABA", main="utilisation de SABA selon le phenotype",axes=FALSE,ylim =c(0,80),col=wes_palette(n=5,name = "BottleRocket1"))
axis(side=1,at=c(3,9,15),labels =c("noT2","T2_25","ensemble") )
axis(side=2)
legend("topright",legend = c(">3 fois par jours","1 à 2 fois par jours","2 fois ou plus par semaines","une fois par semaine ou moins","jamais"),col=wes_palette(n=5,name = "BottleRocket1"),lty = 1)

chisq.test(tabsa)

```

###utilisation des ICS.2

```{r}
summary(DATA$ics_w_gina)
DATA$ics_w_gina<-factor(DATA$ics_w_gina,c("high","medium","low","no ICS"))
tabics<-table(DATA$ics_w_gina,DATA$T2_25)
tabics
cprop(tabics)
barplotNM(a=cprop(tabics)[1:4,1:3],b="utilisation des ICS selon le phenotype",c=4,d=80,e=c(3,8,13),f=c("haut","moyen","bas","pas de CSI"))
chisq.test(tabics)
```

###utilisation des laba.2

```{r}
summary(DATA$laba_w)
tabala<-table(DATA$laba_w,DATA$T2_25)
tabala
cprop(tabala)
barplotNM(a=cprop(tabala)[1:2,1:3],b="utilisation de laba selon le phenotype",c=2,d=80,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabala)
```

###utilisation des leukotriène.2

```{r}
summary(DATA$ltra_w)
tabltra<-table(DATA$ltra_w,DATA$T2_25)
tabltra
cprop(tabltra)
barplotNM(a=cprop(tabltra)[1:2,1:3],b="utilisation de leucotriene selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabltra)
```

###corticoide oraux.2

```{r}
summary(DATA$ocs_w)
#transformation en variable dichotomique:
DATA$ocs_w_nb<-ifelse(DATA$ocs_w_dose==0,"no","yes")
table(DATA$ocs_w_nb)
tabocs<-table(DATA$ocs_w_nb,DATA$T2_25)
cprop(tabocs)
tabocs
barplotNM(a=cprop(tabocs)[1:2,1:3],b="utilisation de CSO selon le phenotype",c=2,d=125,e=c(2,5,8),f=c("non","oui"))
"utilisation du test exact de fischer car effectif attendu de petite taille"
fisher.test(tabocs)
```

###anti-histaminique.2

```{r}
summary(DATA$anti_h1_w)
tabhist<-table(DATA$anti_h1_w,DATA$T2_25)
tabhist
cprop(tabhist)
barplotNM(a=cprop(tabhist)[1:2,1:3],b="utilisation d'anti-histaminique selon le phenotype",c=2,d=100,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabhist)
```

###corticoide nasaux.2

```{r}
summary(DATA$ncs_w)
tabncs<-table(DATA$ncs_w,DATA$T2_25)
tabncs
cprop(tabncs)
barplotNM(a=cprop(tabncs)[1:2,1:3],b="utilisation d'anti-histaminique nasaux selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabncs)
```

###sévérite GINA.2

```{r}
summary(DATA$severity_asthma_gina_w)
DATA$severity_asthma_gina_w<-factor(DATA$severity_asthma_gina_w,c("severe","moderate","mild","no treatment"))
tabgin<-table(DATA$severity_asthma_gina_w,DATA$T2)
tabgin
cprop(tabgin)
barplotNM(a=cprop(tabgin)[1:4,1:3],b="stade de severite selon le GINA",c=4,d=60,e=c(3,8,13),f=c("severe","modere","leger","non traite"))
chisq.test(tabgin)
```

###exacerbation.2

```{r}
summary(DATA$exacerbation_w)
#transformation en variable dichotomique (plus d'une exacerbation ou pas)
DATA$exacerbation_w_nb<-ifelse(DATA$exacerbation_w==0,"no","yes")
DATA$exacerbation_w_nb<-factor(DATA$exacerbation_w_nb)
summary(DATA$exacerbation_w_nb)
tabex<-table(DATA$exacerbation_w_nb,DATA$T2_25)
tabex
cprop(tabex)
barplotNM(a=cprop(tabex)[1:2,1:3],b="exacerbation l'année precedente selon le phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabex)
```

###non control selon le GINA (création nouvelle variable: non controlé si au moins une exacerbation sévère ou plus de 2 utilisation de SABA par semaine).2
```{r}

tabcont<-table(DATA$uncontrolled_gina_w,DATA$T2_25)
tabcont
cprop(tabcont)
barplotNM(a=cprop(tabcont)[1:2,1:3],b="asthme non controlé",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabcont)
```


###VEMS.2

```{r}
summary(DATA$baseline_fev1)
by(DATA$baseline_fev1,DATA$T2_25,summary)
boxplot(DATA$baseline_fev1~DATA$T2_25,xlab = "phenotype",ylab = "VEMS de base",main="VEMS selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE,ylim=c(0,180))
axis(side=1,at=c(1,2),labels =c("noT2","T2_25") )
legend("topright",legend = c("no T2","T2_25"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$baseline_fev1[DATA$T2_25==1],breaks=200)
hist(DATA$baseline_fev1[DATA$T2_25==0],breaks=200)
var.test(DATA$baseline_fev1[DATA$T2_25==0],DATA$baseline_fev1[DATA$T2_25==1])
t.test(DATA$baseline_fev1[DATA$T2_25==0],DATA$baseline_fev1[DATA$T2_25==1],var.equal = TRUE,na.rm=TRUE)
```

###VEMS<80%.2

```{r}
summary(DATA$baseline_fev1.80.)
tabfev<-table(DATA$baseline_fev1.80.,DATA$T2_25)
tabfev
cprop(tabfev)
barplotNM(a =cprop(tabfev)[1:2,1:3],b=" VEMS<80% selon le phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabfev)
```

###Tiffeneau.2

```{r}
summary(DATA$fev1.fvc)
by(DATA$fev1.fvc,DATA$T2_25,summary)
boxplot(DATA$fev1.fvc~DATA$T2_25,xlab = "phenotype",ylab = "coefficient de Tiffeneau",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2_25") )
legend("topright",legend = c("no T2","T2_25"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$fev1.fvc[DATA$T2_25==1],breaks = 300)
hist(DATA$fev1.fvc[DATA$T2_25==0],breaks = 300)
qqnorm(DATA$fev1.fvc[DATA$T2_25==1])
var.test(DATA$fev1.fvc[DATA$T2_25==1],DATA$fev1.fvc[DATA$T2_25==0])
t.test(DATA$fev1.fvc[DATA$T2_25==1],DATA$fev1.fvc[DATA$T2_25==0],na.rm=TRUE,var.equal = FALSE)
wilcox.test(DATA$fev1.fvc[DATA$T2_25==1],DATA$fev1.fvc[DATA$T2_25==0],na.rm=TRUE)
```

###Trouble Ventilatoire obstructif.2

```{r}
summary(DATA$airway_obstruction)
tabobs<-table(DATA$airway_obstruction,DATA$T2_25)
tabobs
cprop(tabobs)
barplotNM(a=cprop(tabobs)[1:2,1:3],b="obstruction bronchique selon phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabobs)
```

#niveau d'hyperréactivité bronchique.2


```{r}
table(DATA$nsbh_grade)
tabgrad<-table(DATA$nsbh_grade,DATA$T2_25)
tabgrad
cprop(tabgrad)
barplotNM(a=cprop(tabgrad)[1:3,1:3],b="niveau d'HRB selon le phénotype",c=3,d=80,e=c(2,6,10),f=c("absent","modere","severe"))
chisq.test(tabgrad)
```

###Changement Hyper-reactivite bronchique.2 

```{r}
summary(DATA$nsbh_sic_ratio)
by(DATA$nsbh_sic_ratio,DATA$T2_25,summary)
boxplot(DATA$nsbh_sic_ratio~DATA$T2_25,xlab = "phenotype",ylab = "ratio de test d'hyperreactivite bronchique",main="ratio de test d'hyperreactivite bronchique selon le phenotype",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2","T2_25") )
legend("topright",legend = c("no T2","T2_25"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$nsbh_sic_ratio[DATA$T2_25==1],breaks = 400)
hist(DATA$nsbh_sic_ratio[DATA$T2_25==0],breaks = 400)
var.test(DATA$nsbh_sic_ratio[DATA$T2_25==1],DATA$nsbh_sic_ratio[DATA$T2_25==0])
wilcox.test(DATA$nsbh_sic_ratio[DATA$T2_25==1],DATA$nsbh_sic_ratio[DATA$T2_25==0])
```

###Ratio d'HRB>2.2

```{r}
summary(DATA$nsbh_sic_max_ratio)
tabrat<-table(DATA$nsbh_sic_max_ratio,DATA$T2_25)
tabrat
cprop(tabrat)
barplotNM(a=cprop(tabrat)[1:2,1:3],b="taux de ration d'hyper reactivite bronchique superieur a 2 et phenotype",c=2,d=75,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabrat)
```


###Reponse immediate.2

```{r}
summary(DATA$early_reaction)
tabear<-table(DATA$early_reaction,DATA$T2_25)
tabear
cprop(tabear)
barplotNM(a=cprop(tabear)[1:2,1:3],b="nombre de reaction precoce selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabear)
```

###reponse tardif.2

```{r}
summary(DATA$late_reaction)
tablat<-table(DATA$late_reaction,DATA$T2_25)
tablat
cprop(tablat)
barplotNM(a=cprop(tablat)[1:2,1:3],b="nombre de reaction tardive selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(tablat)
```

###reponse precoce uniquement.2

```{r}
#creation de la variable d'interet avec une boucle for
DATA$only_early<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$early_reaction[i]) & is.na(DATA$late_reaction[i])) {
    DATA$only_early[i] <- NA
  }
  if(is.na(DATA$early_reaction[i]) | is.na(DATA$late_reaction[i])) {
    DATA$only_early[i] <- NA
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & DATA$early_reaction[i]=="yes" & DATA$late_reaction[i]=="no"){
    DATA$only_early[i] <- "yes"
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & (DATA$early_reaction[i]!="yes" | DATA$late_reaction[i]!="no")){
    DATA$only_early[i] <- "no"
  }
}

DATA$only_early<-factor(DATA$only_early)
summary(DATA$only_early)
tabonear<-table(DATA$only_early,DATA$T2_25)
tabonear
cprop(tabonear)
barplotNM(a=cprop(tabonear)[1:2,1:3],b="nombre de reaction precoce uniquement selon le phenotype",c="2",d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabonear)

```


###reponse tardive uniquement.2

```{r}
#creation de la variablepar boucle for

DATA$only_late<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$early_reaction[i]) | is.na(DATA$late_reaction[i])) {
    DATA$only_late[i] <- NA
  }
  
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & DATA$early_reaction[i]=="no" & DATA$late_reaction[i]=="yes"){
    DATA$only_late[i] <- "yes"
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & (DATA$early_reaction[i]!="no" | DATA$late_reaction[i]!="yes")){
    DATA$only_late[i] <- "no"
  }
}
DATA$only_late<-factor(DATA$only_late)
summary(DATA$only_late)
tabonlate<-table(DATA$only_late,DATA$T2_25)
tabonlate
cprop(tabonlate)
barplotNM(a=cprop(tabonlate)[1:2,1:3],b="nombre de reaction tardive uniquement selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabonlate)
```




###reponse precoce et tardive.2

```{r}
#creation de la variable par boucle for
DATA$early_late<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$early_reaction[i]) | is.na(DATA$late_reaction[i])) {
    DATA$early_late[i] <- NA
  }
  
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & DATA$early_reaction[i]=="yes" & DATA$late_reaction[i]=="yes"){
    DATA$early_late[i] <- "yes"
  }
  if( (!is.na(DATA$early_reaction[i]) & !is.na(DATA$late_reaction[i])) & (DATA$early_reaction[i]=="no" | DATA$late_reaction[i]=="no")){
    DATA$early_late[i] <- "no"
  }
}

DATA$early_late<-factor(DATA$early_late)
summary(DATA$early_late)

taboth<-table(DATA$early_late,DATA$T2_25)
taboth
cprop(taboth)
barplotNM(a=cprop(taboth)[1:2,1:3],b="proportion de reaction mixte selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(taboth)
```



###expecto pre SIC neutrophile.2

```{r}
summary(DATA$neutro_pre_sic)
by(DATA$neutro_pre_sic,DATA$T2,summary)
boxplot(DATA$neutro_pre_sic~DATA$T2,xlab = "phenotype",ylab = "% neutro au expectoration",main="%neutro dans les expectoration selon le phenotype",col=wes_palette("GrandBudapest1",2),axes=FALSE,ylim=c(0,150))
axis(side=1,at=c(1,2),labels =c("noT2","T2") )
legend("topright",legend = c("no T2","T2"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$neutro_pre_sic[DATA$T2==1],breaks = 100)
hist(DATA$neutro_pre_sic[DATA$T2==0],breaks = 100)
qqnorm(DATA$neutro_pre_sic[DATA$T2==1])
qqnorm(DATA$neutro_pre_sic[DATA$T2==0])
shapiro.test(DATA$neutro_pre_sic[DATA$T2==1])
shapiro.test(DATA$neutro_pre_sic[DATA$T2==0])
var.test(DATA$neutro_pre_sic[DATA$T2==0],DATA$neutro_pre_sic[DATA$T2==1])
t.test(DATA$neutro_pre_sic[DATA$T2==0],DATA$neutro_pre_sic[DATA$T2==1],var.equal = TRUE,na.rm=TRUE)
```

###expecto pre SIC >/=76% neutro.2

```{r}
summary(DATA$neutro_pre_sic.76)
tabneu<-table(DATA$neutro_pre_sic.76,DATA$T2_25)
tabneu
cprop(tabneu)
barplotNM(a=cprop(tabneu)[1:2,1:3],b=" proportion de neutrophile sup ou egale a 76% selon le phenotype",c=2,d=115,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabneu)
```


###expecto pre SIC >/= 61% neutro.2

```{r}
tabneu61<-table(DATA$neutro_pre_sic.61,DATA$T2_25)
tabneu61
cprop(tabneu61)
barplotNM(a =cprop(tabneu61)[1:2,1:3],b=" proportion de neutrophile sup ou egale a 61% selon le phenotype",c="2",d=90,e=c(2,5,8),f=c("non","oui") )

chisq.test(tabneu)
```


###changement de neutrophile au expecto pendant le SIC.2

```{r}
summary(DATA$change_neutro)
by(DATA$change_neutro,DATA$T2_25,summary)
boxplot(DATA$change_neutro~DATA$T2_25,xlab = "phenotype",ylab = "changement de neutrophile dans les expectorations",main="changement de neutrophile dans les expectorations selon le phenotype",col=wes_palette(n=2,name = "GrandBudapest1"),axes=FALSE)
axis(side=1,at=c(1,2),labels =c("noT2_25","T2_25") )
legend("topright",legend = c("no T2_25","T2_25"),col=wes_palette(n=2,name = "GrandBudapest1"),lty = 1)
axis(side=2)
hist(DATA$change_neutro[DATA$T2_25==1],breaks = 75)
hist(DATA$change_neutro[DATA$T2_25==0],breaks = 75)
var.test(DATA$change_neutro[DATA$T2_25==0],DATA$change_neutro[DATA$T2_25==1])
t.test(DATA$change_neutro[DATA$T2_25==0],DATA$change_neutro[DATA$T2_25==1],var.equal = TRUE,na.rm=TRUE)
```

###changement de FeNO pendant le SIC.2

```{r}
summary(DATA$change_feno.17.5ppb)
tabfeno<-table(DATA$change_feno.17.5ppb,DATA$T2_25)
tabfeno
cprop(tabfeno)
barplotNM(a=cprop(tabfeno)[1:2,1:3],b="changement de FeNO sup ou egal à 17.5% selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabfeno)
```


###changement des eosino expecto post SIC.2

```{r}
summary(DATA$change_eosino.3)
tabcheo<-table(DATA$change_eosino.3,DATA$T2_25)
tabcheo
cprop(tabcheo)
barplotNM(a=cprop(tabcheo)[1:2,1:3],b="changement d'Eo dans les expecto sup ou egal a 3% selon le phenotype",c=2,d=90,e=c(2,5,8),f=c("non","oui"))
chisq.test(tabcheo)
```


###profil d'inflammation pre SIC eosinophilique pur (cut off neutro à 61).2

```{r}
#creation de la variable par boucle for
DATA$pre_eosino<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_pre_sic.3[i]) | is.na(DATA$neutro_pre_sic.61[i])) {
    DATA$pre_eosino[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & DATA$eosino_pre_sic.3[i]=="yes" & DATA$neutro_pre_sic.61[i]=="no"){
    DATA$pre_eosino[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & (DATA$eosino_pre_sic.3[i]!="yes" | DATA$neutro_pre_sic.61[i]!="no")){
    DATA$pre_eosino[i] <- "no"
  }
}
DATA$pre_eosino<-factor(DATA$pre_eosino)
#analyse descriptive
tabpreo<-table(DATA$pre_eosino,DATA$T2_25)
tabpreo
cprop(tabpreo)
barplotNM(a =cprop(tabpreo)[1:2,1:3],b="profil sputum pre sic eosino strict par phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui","ensemble") )
chisq.test(tabpreo)

```

###profil neutro pre sic (cut off 61).2

```{r}
#création de la variable
DATA$pre_neutro<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$neutro_pre_sic.61[i])|is.na(DATA$eosino_pre_sic.3[i])){
    DATA$pre_neutro[i]<-NA
  }
  if((!is.na(DATA$neutro_pre_sic.61[i]) & !is.na(DATA$eosino_pre_sic.3[i])) & (DATA$neutro_pre_sic.61[i]=="yes" & DATA$eosino_pre_sic.3[i]=="no")){
    DATA$pre_neutro[i]<-"yes"
  }
  if((!is.na(DATA$neutro_pre_sic.61[i]) & !is.na(DATA$eosino_pre_sic.3[i])) & (DATA$neutro_pre_sic.61[i]!="yes" & DATA$eosino_pre_sic.3[i]!="no")){
    DATA$pre_neutro[i]<-"no"
}
}
#descriptif
tabpreneu<-table(DATA$pre_neutro,DATA$T2_25)
tabpreneu
cprop(tabpreneu)
by(DATA$pre_neutro,DATA$T2_25,summary)
barplotNM(a=cprop(tabpreneu)[1:2,1:3],b="profil sputum neutro strict selon le phenotype",c=2,d=130,e=c(2,5,8),f=c("non","yes"))
chisq.test(tabpreneu)
```

###profil mixed granulocytic.2

```{r}
#creation de la variable par boucle for
DATA$pre_mixte<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_pre_sic.3[i]) | is.na(DATA$neutro_pre_sic.61[i])) {
    DATA$pre_mixed[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & DATA$eosino_pre_sic.3[i]=="yes" & DATA$neutro_pre_sic.61[i]=="yes"){
    DATA$pre_mixed[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & (DATA$eosino_pre_sic.3[i]!="yes" | DATA$neutro_pre_sic.61[i]!="yes")){
    DATA$pre_mixed[i] <- "no"
  }
}
#descriptif
tabpremix<-table(DATA$pre_mixed,DATA$T2_25)
by(DATA$pre_mixed,DATA$T2_25,table)
DATA$pre_mixed<-factor(DATA$pre_mixed)
cprop(tabpremix)
barplotNM(a=cprop(tabpremix)[1:2,1:3],b="profil sputum mixed granulocytique selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("no","yes"))
chisq.test(tabpremix)
```

###profil pre paucigranulocytic.2

```{r}
DATA$pre_pauci<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_pre_sic.3[i]) | is.na(DATA$neutro_pre_sic.61[i])) {
    DATA$pre_pauci[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & DATA$eosino_pre_sic.3[i]=="no" & DATA$neutro_pre_sic.61[i]=="no"){
    DATA$pre_pauci[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_pre_sic.3[i]) & !is.na(DATA$neutro_pre_sic.61[i])) & (DATA$eosino_pre_sic.3[i]!="no" | DATA$neutro_pre_sic.61[i]!="no")){
    DATA$pre_pauci[i] <- "no"
  }
}
tabprepauci<-table(DATA$pre_pauci,DATA$T2_25)
by(DATA$pre_pauci,DATA$T2_25,summary)
cprop(tabprepauci)
barplotNM(a=cprop(tabprepauci)[1:2,1:3],b="profil sputum paucigranulocytique selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("no","yes"))
chisq.test(tabprepauci)

```
###analyse des résultats post SIC
```{r}
#eosino post sic
DATA$eosino_post_sic.3<-ifelse(DATA$eosino_post_sic>=3,"yes","no")
#neutro post sic
DATA$neutro_post_sic.61<-ifelse(DATA$neutro_post_sic>=61,"yes","no")

```

###profil d'inflammation post SIC eosinophilique pur (cut off neutro à 61)

```{r}
#creation de la variable par boucle for
DATA$post_eosino<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_post_sic.3[i]) | is.na(DATA$neutro_post_sic.61[i])) {
    DATA$post_eosino[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_post_sic.3[i]) & !is.na(DATA$neutro_post_sic.61[i])) & DATA$eosino_post_sic.3[i]=="yes" & DATA$neutro_post_sic.61[i]=="no"){
    DATA$post_eosino[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_post_sic.3[i]) & !is.na(DATA$neutro_post_sic.61[i])) & (DATA$eosino_post_sic.3[i]!="yes" | DATA$neutro_post_sic.61[i]!="no")){
    DATA$post_eosino[i] <- "no"
  }
}
DATA$post_eosino<-factor(DATA$post_eosino)
#analyse descriptive
tabposto<-table(DATA$post_eosino,DATA$T2)
tabposto
cprop(tabposto)
barplotNM(a =cprop(tabposto)[1:2,1:3],b="profil sputum post sic eosino strict par phenotype",c=2,d=110,e=c(2,5,8),f=c("non","oui","ensemble") )
chisq.test(tabposto)
```

###profil neutro post sic (cut off 61)

```{r}
#création de la variable
DATA$post_neutro<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$neutro_post_sic.61[i])|is.na(DATA$eosino_post_sic.3[i])){
    DATA$post_neutro[i]<-NA
  }
  if((!is.na(DATA$neutro_post_sic.61[i]) & !is.na(DATA$eosino_post_sic.3[i])) & (DATA$neutro_post_sic.61[i]=="yes" & DATA$eosino_post_sic.3[i]=="no")){
    DATA$post_neutro[i]<-"yes"
  }
  if((!is.na(DATA$neutro_post_sic.61[i]) & !is.na(DATA$eosino_post_sic.3[i])) & (DATA$neutro_post_sic.61[i]!="yes" & DATA$eosino_post_sic.3[i]!="no")){
    DATA$post_neutro[i]<-"no"
  }
}
#descriptif
tabpostneu<-table(DATA$post_neutro,DATA$T2)
tabpostneu
cprop(tabpostneu)
by(DATA$post_neutro,DATA$T2,summary)
barplotNM(a=cprop(tabpostneu)[1:2,1:3],b="profil sputum neutro strict selon le phenotype",c=2,d=130,e=c(2,5,8),f=c("non","yes"))
```

###profil mixed granulocytic post SIC

```{r}
#creation de la variable par boucle for
DATA$post_mixte<-NULL
for(i in 1:dim(DATA)[1]){
  
  if(is.na(DATA$eosino_post_sic.3[i]) | is.na(DATA$neutro_post_sic.61[i])) {
    DATA$post_mixed[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_post_sic.3[i]) & !is.na(DATA$neutro_post_sic.61[i])) & DATA$eosino_post_sic.3[i]=="yes" & DATA$neutro_post_sic.61[i]=="yes"){
    DATA$post_mixed[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_post_sic.3[i]) & !is.na(DATA$neutro_post_sic.61[i])) & (DATA$eosino_post_sic.3[i]!="yes" | DATA$neutro_post_sic.61[i]!="yes")){
    DATA$post_mixed[i] <- "no"
  }
}
#descriptif
tabpostmix<-table(DATA$post_mixed,DATA$T2)
by(DATA$post_mixed,DATA$T2,table)
DATA$post_mixed<-factor(DATA$post_mixed)
cprop(tabpostmix)
barplotNM(a=cprop(tabpostmix)[1:2,1:3],b="profil sputum mixed granulocytique selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("no","yes"))


```

###profil post paucigranulocytic

```{r}
DATA$post_pauci<-NULL
for(i in 1:dim(DATA)[1]){
  if(is.na(DATA$eosino_post_sic.3[i]) | is.na(DATA$neutro_post_sic.61[i])) {
    DATA$post_pauci[i] <- NA
  }
  
  if( (!is.na(DATA$eosino_post_sic.3[i]) & !is.na(DATA$neutro_post_sic.61[i])) & DATA$eosino_post_sic.3[i]=="no" & DATA$neutro_post_sic.61[i]=="no"){
    DATA$post_pauci[i] <- "yes"
  }
  if( (!is.na(DATA$eosino_post_sic.3[i]) & !is.na(DATA$neutro_post_sic.61[i])) & (DATA$eosino_post_sic.3[i]!="no" | DATA$neutro_post_sic.61[i]!="no")){
    DATA$post_pauci[i] <- "no"
  }
}
tabpostpauci<-table(DATA$post_pauci,DATA$T2)
by(DATA$post_pauci,DATA$T2,summary)
cprop(tabpostpauci)
barplotNM(a=cprop(tabpostpauci)[1:2,1:3],b="profil sputum paucigranulocytique selon le phenotype",c=2,d=120,e=c(2,5,8),f=c("no","yes"))
chisq.test(tabpostpauci)
```


##synthèse des données sputum selon phénotype

###Avant l'exposition

```{r}
#création camenbert T2_25
valeurs<-c(22.8,16.9,44.3,16)
pie(valeurs,col=wes_palette(n=4,name = "GrandBudapest1"),labels=c("paucigranulomateux","mixed granulomateux","eosinophilique strict","neutrophilique"),main="distribution endotypique des asthmes T2_25")

#création camenbert noT2

valeursno2<-c(60.8,39.2)
pie(valeursno2,col=wes_palette(n=2,name = "GrandBudapest1"),labels=c("paucigranulomateux","neutrophilique"),main="distribution endotypique des asthmes non T2")

```
###Apres exposition

```{r}
#synthèse résultat post SIC

#création camenbert T2
valeurs<-c(7.7,22,65,4.9)
pie(valeurs,col=wes_palette(n=4,name = "GrandBudapest1"),labels=c("neutrophilique","mixed granulomateux","eosinophilique strict","paucigranulomateux"),main="distribution endotypique des asthmes T2 post SIC")

#création camenbert noT2

valeursno2<-c(14.9,20,40,24.6)
pie(valeursno2,col=wes_palette(n=4,name = "GrandBudapest1"),labels=c("neutrophilique","mixed granulomateux","eosinophilique strict","paucigranulomateux"),main="distribution endotypique des asthmes non T2 post SIC")

```
## Analyse univarié variable T2
```{r}
#creation fonction pour analyse logistique:
logNM<-function(a){
  
  logistic<-glm(DATA$T2~a,family=binomial)
  
  print(summary(logistic))
  
  exp(cbind(Odds_Ration=coef(logistic),confint(logistic)))  
}
```



###log age

```{r}
logNM(a=DATA$age)
         
```

###logbmi

```{r}
logNM(DATA$bmi)
```

###logsex

```{r}
logNM(DATA$sex)
```

###lograce

```{r}
logNM(DATA$race)
```

###Logeducation

```{r}
logNM(a=as.factor(DATA$education))
```

###LogHMW

```{r}
logNM(DATA$hmw.lmw)
```

###logsmoker

```{r}
logNM(as.factor(DATA$smoker))
```


### logasthme préexistant

```{r}
logNM(DATA$asthma_pre)
```

###logAge d'apparition

```{r}
logNM(as.factor(DATA$age_onset_cat))
```

###logatopy

```{r}
logNM(DATA$atopy)
```


###logdélai d'apparition symptomes asthme

```{r}
logNM(DATA$asthma_delay)
```

###logdurée de l'exposition avec symptomes

```{r}
logNM(DATA$asthma_work_time)
```


###logsinusite

```{r}
logNM(DATA$sinusitis)
```

###logcough

```{r}
logNM(DATA$cough_w)
```

###logwheezzing

```{r}

logNM(DATA$wheezing_w)
```

###logDyspnea

```{r}
logNM(DATA$dyspnea_w)
```


###logtightness

```{r}
logNM(DATA$tightness_w)
```


###logsputum

```{r}
logNM(DATA$sputum)
```

###logrhinitis

```{r}
logNM(DATA$rhinitis_w)
```

###logonselt rhinitis/ creation variable onset_of_rhinitis_w_na

```{r}
DATA$onset_of_rhinitis_w_na<-DATA$onset_of_rhinitis_w
DATA$onset_of_rhinitis_w_na[DATA$onset_of_rhinitis_w%in%c("not applicable")]<-NA
logNM(DATA$onset_of_rhinitis_w_na)
```
 
### logconjoctivite
 
```{r}
logNM(DATA$conjonct_w)
```
 
### log eczema
 
```{r}
logNM(DATA$eczema_w)
```
 
### Log urticaire

```{r}
logNM(DATA$urticaria_w) 
```



###log dysphonie

```{r}
logNM(DATA$dysphonia_w)
```

###log specific IgE/création variable ige_mediated_oa_na

```{r}
DATA$ige_mediated_oa_na<-as.character(DATA$ige_mediated_oa)
DATA$ige_mediated_oa_na[DATA$ige_mediated_oa_na%in%c("not performed")]<-NA
DATA$ige_mediated_oa_na<-factor(DATA$ige_mediated_oa_na)

logNM(DATA$ige_mediated_oa_na)
```

###log SABA_frequence

```{r}
logNM(DATA$saba_w_frequency)
```

###logLABA

```{r}
logNM(DATA$laba_w)
```

### logseverite GINA

```{r}
logNM(DATA$ics_w_gina)
```

###logleukotriène

```{r}
logNM(DATA$ltra_w)
```

###log_lama

```{r}
logNM(DATA$lama_w)
```


###logtheophylline

```{r}
logNM(DATA$theo_w)
```

###logcorticoide oraux

```{r}

logNM(DATA$ocs_w_dose)
```

###loganti-igE

```{r}
logNM(DATA$anti.ige_w)
```


###logmepo

```{r}
logNM(DATA$mepo_w)
```

###logantihist

```{r}
logNM(DATA$anti_h1_w)
```

###logncs

```{r}
logNM(DATA$ncs_w)
```

###logseverite gina

```{r}
logNM(DATA$severity_asthma_gina_w)
```

### logexacerbation

```{r}
logNM(DATA$exacerbation_w_nb)
```

###délai avant test d'expo

```{r}
logNM(DATA$time_last_exp_m)
```

###VEMS

```{r}
logNM(DATA$baseline_fev1)
```

###logtiffeneau

```{r}
logNM(DATA$fev1.fvc)
```

###logobstruction bronchique

```{r}
logNM(DATA$airway_obstruction)
```

###lognsbh
```{r}
logNM(DATA$nsbh_grade)
```

###logréaction précoce isolée
```{r}
logNM(DATA$only_early)
```

###réaction mixte

```{r}
logNM(DATA$early_late)
```

###réaction tardive seule

```{r}

logNM(DATA$only_late)
```

###logchangement d'hyperréactivité bronchique supérieur à 2

```{r}
logNM(DATA$nsbh_sic_max_ratio)
```

###change FENO 17,5 ppb
```{r}
logNM(DATA$change_feno.17.5ppb)
```

###log neutro expectoration

```{r}
logNM(DATA$neutro_pre_sic.61)
```


